{
  "name": "Sales Leads Scraper",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 7
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -672,
        3472
      ],
      "id": "0cd83540-60ff-4c3f-bfbc-86864b197c2f",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"people\": {\n    \"titles_primary\": [\n      \"Head of AI\",\n      \"Head of Generative AI\",\n      \"Director of AI\",\n      \"VP AI\",\n      \"VP Engineering\",\n      \"Director of Machine Learning\",\n      \"Head of Machine Learning\",\n      \"Director of Data Science\",\n      \"Head of Data Science\",\n      \"Chief AI Officer\",\n      \"AI Architect\",\n      \"Head of Platform\",\n      \"Chief Data Officer\"\n    ],\n    \"titles_secondary\": [\n      \"Principal Engineer\",\n      \"Staff Engineer\",\n      \"Lead Machine Learning Engineer\",\n      \"AI Platform Lead\",\n      \"ML Platform Lead\",\n      \"MLOps Lead\",\n      \"Engineering Manager AI\",\n      \"Data Science Manager\",\n      \"Applied AI Lead\"\n    ],\n    \"skills_signals\": [\n      \"Generative AI\",\n      \"LLM\",\n      \"Large Language Models\",\n      \"AI assistant\",\n      \"Chatbot\",\n      \"Conversational AI\",\n      \"RAG\",\n      \"Retrieval Augmented Generation\",\n      \"AI governance\",\n      \"AI compliance\",\n      \"Model deployment\",\n      \"Model monitoring\",\n      \"Enterprise AI\",\n      \"MLOps\",\n      \"LLMOps\",\n      \"LangChain\",\n      \"Vector database\"\n    ],\n    \"exclude\": [\n      \"intern\",\n      \"student\",\n      \"phd\",\n      \"researcher\",\n      \"professor\",\n      \"postdoc\",\n      \"consultant\",\n      \"freelancer\",\n      \"trainer\",\n      \"bootcamp\",\n      \"academy\"\n    ]\n  },\n  \"company\": {\n    \"buyer_indicators\": [\n      \"AI-powered\",\n      \"Generative AI\",\n      \"AI platform\",\n      \"LLM platform\",\n      \"Conversational AI\",\n      \"Intelligent assistant\",\n      \"Customer-facing AI\",\n      \"Internal AI tools\",\n      \"AI assistant\",\n      \"Developer platform\",\n      \"AI-driven\",\n      \"Embedded AI\"\n    ],\n    \"industry_focus\": [\n      \"SaaS\",\n      \"Enterprise Software\",\n      \"FinTech\",\n      \"Banking\",\n      \"HealthTech\",\n      \"Healthcare\",\n      \"E-commerce\",\n      \"Retail\",\n      \"Data Platform\",\n      \"Cloud Platform\",\n      \"Customer Support Technology\"\n    ],\n    \"exclude\": [\n      \"agency\",\n      \"consulting\",\n      \"services\",\n      \"outsourcing\",\n      \"training\",\n      \"bootcamp\",\n      \"academy\"\n    ]\n  },\n  \"updates_signals\": {\n    \"high_intent\": [\n      \"launched\",\n      \"rolled out\",\n      \"now live\",\n      \"we built\",\n      \"we developed\",\n      \"we shipped\",\n      \"in production\",\n      \"deployed\",\n      \"integrated\",\n      \"customer-facing\",\n      \"case study\"\n    ],\n    \"medium_intent\": [\n      \"increased\",\n      \"boosted\",\n      \"reduced\",\n      \"decreased\",\n      \"saved\",\n      \"ROI\",\n      \"conversion\",\n      \"revenue\",\n      \"tickets\",\n      \"support volume\",\n      \"call deflection\",\n      \"time to resolution\",\n      \"cost savings\"\n    ],\n    \"tech_mentions\": [\n      \"AI assistant\",\n      \"chatbot\",\n      \"support bot\",\n      \"helpdesk AI\",\n      \"copilot\",\n      \"knowledge base\",\n      \"knowledge assistant\",\n      \"RAG\",\n      \"LLM\",\n      \"OpenAI\",\n      \"ChatGPT\",\n      \"GPT-4\",\n      \"Anthropic\",\n      \"LangChain\"\n    ],\n    \"competitor_mentions\": [\n      \"Lakera\",\n      \"Protect AI\",\n      \"PromptSecurity\",\n      \"Zenity\",\n      \"SentinelOne\",\n      \"Noma Security\"\n    ]\n  },\n  \"events\": {\n    \"event_intent_phrases\": [\n      \"speaking at\",\n      \"speaker\",\n      \"keynote\",\n      \"panel\",\n      \"fireside chat\",\n      \"workshop\",\n      \"hosting a meetup\",\n      \"meetup\",\n      \"conference\",\n      \"expo\"\n    ],\n    \"sponsor_booth_phrases\": [\n      \"exhibiting\",\n      \"booth\",\n      \"sponsor\",\n      \"platinum sponsor\",\n      \"gold sponsor\",\n      \"partner pavilion\",\n      \"visit us at\",\n      \"see you at\",\n      \"come find us\"\n    ],\n    \"security_genai_event_topics\": [\n      \"AI security\",\n      \"GenAI security\",\n      \"LLM security\",\n      \"prompt injection\",\n      \"jailbreak\",\n      \"AI governance\",\n      \"model risk\",\n      \"AI compliance\",\n      \"GRC\",\n      \"AppSec\"\n    ],\n    \"conference_series_keywords\": [\n      \"RSA Conference\",\n      \"Black Hat\",\n      \"DEF CON\",\n      \"BSides\",\n      \"OWASP\",\n      \"Gartner Security\",\n      \"Gartner Data & Analytics\",\n      \"KubeCon\",\n      \"AWS re:Invent\"\n    ],\n    \"genai_conference_keywords\": [\n      \"OpenAI DevDay\",\n      \"AI Engineer Summit\",\n      \"World Summit AI\",\n      \"ODSC\",\n      \"NeurIPS\",\n      \"ICLR\",\n      \"ICML\",\n      \"NVIDIA GTC\"\n    ],\n    \"meetup_organizer_signals\": [\n      \"organizer\",\n      \"chapter lead\",\n      \"community lead\",\n      \"event host\",\n      \"program chair\"\n    ]\n  }\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -448,
        2608
      ],
      "id": "2d4487e8-bb84-47ea-88c0-03fe99b823ec",
      "name": "keyword filter"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"people\": {\n    \"titles_primary\": [\n      \"Head of AI\",\n      \"Head of Generative AI\",\n      \"Director of AI\",\n      \"VP AI\",\n      \"VP Engineering\",\n      \"Director of Machine Learning\",\n      \"Head of Machine Learning\",\n      \"Director of Data Science\",\n      \"Head of Data Science\",\n      \"Chief AI Officer\",\n      \"AI Architect\",\n      \"Head of Platform\",\n      \"Chief Data Officer\"\n    ],\n    \"titles_secondary\": [\n      \"Principal Engineer\",\n      \"Staff Engineer\",\n      \"Lead Machine Learning Engineer\",\n      \"AI Platform Lead\",\n      \"ML Platform Lead\",\n      \"MLOps Lead\",\n      \"Engineering Manager AI\",\n      \"Data Science Manager\",\n      \"Applied AI Lead\"\n    ],\n    \"skills_signals\": [\n      \"Generative AI\",\n      \"LLM\",\n      \"Large Language Models\",\n      \"AI assistant\",\n      \"Chatbot\",\n      \"Conversational AI\",\n      \"RAG\",\n      \"Retrieval Augmented Generation\",\n      \"AI governance\",\n      \"AI compliance\",\n      \"Model deployment\",\n      \"Model monitoring\",\n      \"Enterprise AI\",\n      \"MLOps\",\n      \"LLMOps\",\n      \"LangChain\",\n      \"Vector database\"\n    ],\n    \"exclude\": [\n      \"intern\",\n      \"student\",\n      \"phd\",\n      \"researcher\",\n      \"professor\",\n      \"postdoc\",\n      \"consultant\",\n      \"freelancer\",\n      \"trainer\",\n      \"bootcamp\",\n      \"academy\"\n    ]\n  },\n  \"company\": {\n    \"buyer_indicators\": [\n      \"AI-powered\",\n      \"Generative AI\",\n      \"AI platform\",\n      \"LLM platform\",\n      \"Conversational AI\",\n      \"Intelligent assistant\",\n      \"Customer-facing AI\",\n      \"Internal AI tools\",\n      \"AI assistant\",\n      \"Developer platform\",\n      \"AI-driven\",\n      \"Embedded AI\"\n    ],\n    \"industry_focus\": [\n      \"SaaS\",\n      \"Enterprise Software\",\n      \"FinTech\",\n      \"Banking\",\n      \"HealthTech\",\n      \"Healthcare\",\n      \"E-commerce\",\n      \"Retail\",\n      \"Data Platform\",\n      \"Cloud Platform\",\n      \"Customer Support Technology\"\n    ],\n    \"exclude\": [\n      \"agency\",\n      \"consulting\",\n      \"services\",\n      \"outsourcing\",\n      \"training\",\n      \"bootcamp\",\n      \"academy\"\n    ]\n  },\n  \"updates_signals\": {\n    \"high_intent\": [\n      \"launched\",\n      \"rolled out\",\n      \"now live\",\n      \"we built\",\n      \"we developed\",\n      \"we shipped\",\n      \"in production\",\n      \"deployed\",\n      \"integrated\",\n      \"customer-facing\",\n      \"case study\"\n    ],\n    \"medium_intent\": [\n      \"increased\",\n      \"boosted\",\n      \"reduced\",\n      \"decreased\",\n      \"saved\",\n      \"ROI\",\n      \"conversion\",\n      \"revenue\",\n      \"tickets\",\n      \"support volume\",\n      \"call deflection\",\n      \"time to resolution\",\n      \"cost savings\"\n    ],\n    \"tech_mentions\": [\n      \"AI assistant\",\n      \"chatbot\",\n      \"support bot\",\n      \"helpdesk AI\",\n      \"copilot\",\n      \"knowledge base\",\n      \"knowledge assistant\",\n      \"RAG\",\n      \"LLM\",\n      \"OpenAI\",\n      \"ChatGPT\",\n      \"GPT-4\",\n      \"Anthropic\",\n      \"LangChain\"\n    ],\n    \"competitor_mentions\": [\n      \"Lakera\",\n      \"Protect AI\",\n      \"PromptSecurity\",\n      \"Zenity\",\n      \"SentinelOne\",\n      \"Noma Security\"\n    ]\n  },\n  \"events\": {\n    \"event_intent_phrases\": [\n      \"speaking at\",\n      \"speaker\",\n      \"keynote\",\n      \"panel\",\n      \"fireside chat\",\n      \"workshop\",\n      \"hosting a meetup\",\n      \"meetup\",\n      \"conference\",\n      \"expo\"\n    ],\n    \"sponsor_booth_phrases\": [\n      \"exhibiting\",\n      \"booth\",\n      \"sponsor\",\n      \"platinum sponsor\",\n      \"gold sponsor\",\n      \"partner pavilion\",\n      \"visit us at\",\n      \"see you at\",\n      \"come find us\"\n    ],\n    \"security_genai_event_topics\": [\n      \"AI security\",\n      \"GenAI security\",\n      \"LLM security\",\n      \"prompt injection\",\n      \"jailbreak\",\n      \"AI governance\",\n      \"model risk\",\n      \"AI compliance\",\n      \"GRC\",\n      \"AppSec\"\n    ],\n    \"conference_series_keywords\": [\n      \"RSA Conference\",\n      \"Black Hat\",\n      \"DEF CON\",\n      \"BSides\",\n      \"OWASP\",\n      \"Gartner Security\",\n      \"Gartner Data & Analytics\",\n      \"KubeCon\",\n      \"AWS re:Invent\"\n    ],\n    \"genai_conference_keywords\": [\n      \"OpenAI DevDay\",\n      \"AI Engineer Summit\",\n      \"World Summit AI\",\n      \"ODSC\",\n      \"NeurIPS\",\n      \"ICLR\",\n      \"ICML\",\n      \"NVIDIA GTC\"\n    ],\n    \"meetup_organizer_signals\": [\n      \"organizer\",\n      \"chapter lead\",\n      \"community lead\",\n      \"event host\",\n      \"program chair\"\n    ]\n  }\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -96,
        2832
      ],
      "id": "9afb939a-2ebc-4a6e-a29c-a87cb531640a",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "operation": "search profile",
        "searchProfileParams": {
          "keyword": "={{\n  '(' + $('Keyword Generator').item.json.output.people.slice(0,5).join(', ') + ')'\n  + ' NOT (' + $('Keyword Generator').item.json.output.people_excludes.join(', ') + ')'\n}}",
          "end_page": 5
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        416,
        1920
      ],
      "id": "0a796e0e-8f6d-41a6-83cb-c8ecb0bbe8c0",
      "name": "Search for profiles",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "resource": "company",
        "searchCompaniesParams": {
          "keyword": "={{\n  '(' +\n  $('Keyword Generator').item.json.output.company\n    .slice(0,5)\n    .join(', ') +\n  ') NOT (' +\n  $('Keyword Generator').item.json.output.company_excludes\n    .join(', ') +\n  ')'\n}}",
          "total_results": 100,
          "end_page": 5
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        416,
        2112
      ],
      "id": "5b18c9a5-9e84-4261-b22a-72449966d13f",
      "name": "Search for companies",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "resource": "post",
        "operation": "search posts",
        "searchPostsParams": {
          "sort_by": "recent",
          "keyword": "={{\n  $('Keyword Generator').item.json.output.updates_signals\n    .slice(0,5)\n    .join(', ')\n}}",
          "end_page": 5
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        416,
        2304
      ],
      "id": "4122434f-fcb6-4bca-ad9f-5e47fb4de493",
      "name": "Search for posts",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get profile info",
        "getProfileInfoParams": {
          "linkedin_url": "={{ $json.target_url }}"
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        4752,
        1792
      ],
      "id": "520d9096-2f27-49d1-b96c-51b94118729f",
      "name": "Get a profile's information",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Here is the current keyword JSON:\n{{ $('keyword filter') }}\nReturn the vetted JSON only.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "{\n  \"system\": \"You are a precision editor for a LinkedIn prospecting keyword JSON. Your job is to make the keyword set more predictive of real buyers and high-value marketing surfaces for Acuvity: an enterprise GenAI security, governance, and risk platform (prompt injection/jailbreak protection, policy controls, monitoring, compliance). You optimize for signal quality and purchase intent, not breadth.\",\n  \"user\": \"You will receive a JSON with exactly these top-level keys: people, people_excludes, company, company_excludes, updates_signals, events. Edit it lightly to improve buyer precision and event relevance for Acuvity.\",\n  \"rules\": {\n    \"output\": [\n      \"Return VALID JSON ONLY (no commentary, no markdown).\",\n      \"Preserve the existing JSON structure and keys EXACTLY.\",\n      \"Do NOT add new keys, do NOT rename keys, do NOT change nesting.\"\n    ],\n    \"editing_policy\": [\n      \"Precision over expansion: prefer removing or rewriting over adding.\",\n      \"Make MINIMAL changes; change a list only if it clearly improves AI security, governance, or enterprise GenAI buyer relevance.\",\n      \"If an item already meets buyer-intent and relevance criteria, KEEP IT UNCHANGED.\",\n      \"Keep each list <= 20 items. If a list is >20, prune to the best 20.\",\n      \"Ensure exclude lists are non-empty; add only the minimum excludes if missing.\"\n    ],\n    \"selection_criteria_prefer\": [\n      \"Decision-makers or owners (VP, Head, Director, CISO, CIO) tied to AI, security, risk, platform, or compliance.\",\n      \"Signals of enterprise or production GenAI (RAG, copilots, assistants) with governance or security needs.\",\n      \"Security and compliance responsibility (AI governance, model risk, GRC, security engineering, AppSec).\",\n      \"Buying or evaluation signals (vendor selection, integration, rollout, audits, SOC2/ISO, production incidents).\",\n      \"Events where enterprise AI, GenAI security, AppSec, or governance buyers are likely to attend or speak.\"\n    ],\n    \"selection_criteria_avoid\": [\n      \"Purely generic AI terms without enterprise or governance context.\",\n      \"Academic or research-only roles, educators, bootcamps, or hobbyist builders.\",\n      \"Agencies, consultancies, or outsourcing firms as target companies.\",\n      \"Overlapping synonyms or near-duplicate phrases.\",\n      \"Academic-only or research-only events with low buyer density.\"\n    ],\n    \"rewrite_rules\": [\n      \"If two items overlap, keep the more buyer-intent or enterprise-owned version.\",\n      \"Prefer phrases that indicate responsibility (e.g., 'AI Governance' over 'AI').\",\n      \"Prefer security-for-GenAI framing over generic LLM mentions unless tied to production.\",\n      \"For events, prefer well-known conference series, sponsor or exhibitor signals, and practitioner-led meetups over generic AI conferences.\",\n      \"Do NOT rewrite keyword-style phrases into different wording unless the original is unclear, misleading, or materially lower-signal.\"\n    ]\n  },\n  \"execution_steps\": [\n    \"Validate structure: confirm only expected keys exist and preserve them.\",\n    \"For each list, score items for Acuvity relevance (0–3) using the criteria.\",\n    \"Prune only low-scoring or redundant items until list length <= 20.\",\n    \"Optionally replace up to 2 low-signal items per list with higher-signal equivalents ONLY if it clearly improves buyer precision.\",\n    \"If no clear improvement exists for a list or item, leave it unchanged.\",\n    \"Return the final JSON. If no clear improvements exist overall, return the input unchanged.\"\n  ],\n  \"scoring_rubric\": {\n    \"3\": \"Direct buyer or field-marketing signal for enterprise GenAI security or governance (CISO, AppSec, AI Governance ownership; RSA, Black Hat, GenAI security summits).\",\n    \"2\": \"Strong proximity to enterprise GenAI adoption or platform ownership (Head of AI talks, ML platform ownership, applied GenAI conferences).\",\n    \"1\": \"General AI or ML involvement without clear security, governance, or buyer ownership.\",\n    \"0\": \"Noisy or irrelevant to Acuvity buyers (academic-only, hobbyist, generic tech content).\"\n  },\n  \"hard_filters\": {\n    \"people_excludes_must_include\": [\n      \"intern\",\n      \"student\",\n      \"phd\",\n      \"researcher\",\n      \"consultant\",\n      \"freelancer\",\n      \"trainer\",\n      \"bootcamp\"\n    ],\n    \"company_excludes_must_include\": [\n      \"agency\",\n      \"consulting\",\n      \"outsourcing\",\n      \"training\",\n      \"staffing\"\n    ]\n  }\n}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -192,
        2608
      ],
      "id": "abcb1e8f-831e-4db4-86c5-51567f954de8",
      "name": "Keyword Generator"
    },
    {
      "parameters": {
        "resource": "post",
        "operation": "search posts",
        "searchPostsParams": {
          "keyword": "={{\n  $('Keyword Generator').item.json.output.events\n    .slice(0,5)\n    .join(', ')\n}}",
          "total_results": 200
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        416,
        2496
      ],
      "id": "4afb2c54-b9bb-4445-868e-58b746b8086a",
      "name": "Search for events",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Use the input keyword JSON at $json.output.\n\nDo the work in this exact order and run searches in each stage:\n\nSTAGE 1 People (run 3 queries):\n- Create 3 queries using ONE title from $json.output.people each time.\n- Add ONE update signal from $json.output.updates_signals for context.\n- Add negative terms from $json.output.people_excludes using '-' before each term.\n\nSTAGE 2 Company (run 3 queries):\n- Create 3 queries using ONE industry term from $json.output.company each time.\n- Add ONE update signal from $json.output.updates_signals.\n- Add negative terms from $json.output.company_excludes using '-' before each term.\n\nSTAGE 3 Update signals (run 3 queries):\n- Create 3 queries using ONE phrase from $json.output.updates_signals each time.\n- Add at least one of: \"GenAI\" OR \"LLM\" OR \"AI governance\" OR \"prompt injection\" to keep it relevant.\n\nSTAGE 4 Events (run 5 queries):\n- For EACH of the first 5 items in $json.output.events:\n  Run two searches:\n  (a) \"<EVENT NAME> official site sponsor exhibitor\"\n  (b) \"site:eventbrite.com <EVENT NAME>\" OR \"site:lu.ma <EVENT NAME>\" OR \"site:meetup.com <EVENT NAME>\"\n  Choose the best one if the tool only allows one search per event.\n\nOutput:\n- Group results into people_search, company_search, updates_search, events_search.\n- Each element must include:\n  - query\n  - links (up to 20), each link has title,url,source,snippet\n- Only include links you found via web search tool results.\n- If you cannot find any, return empty links but do not omit the query.\n\nInput keyword JSON:\n{{$json.output}}\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a web research agent for Acuvity prospecting.\nYou MUST use the web search tool in this node to find results.\n\nHard rules:\n- For every query you create, you MUST execute a web search tool call.\n- Only return links that appear in tool results. Never invent URLs.\n- If a query returns no results, still include it with an empty links array.\n- Output valid JSON only that matches the schema. No extra text.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        336,
        2688
      ],
      "id": "b7b60053-0aed-4944-8286-016fbae4343e",
      "name": "Web search",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "=profile",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "1e81a5ef-bb8c-43e3-b381-28f38f3b9e79"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "profile"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "12742cb2-2b7c-4103-ab66-127c24bdc8ba",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "company",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Company"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ceed7fa9-9e9c-4256-b9bc-8b157333c234",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "post",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Posts"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "cd6cc2e1-0d02-4156-b4a3-5cc6838e0b67",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "people",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Web Search Profile"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6ced084e-043c-4aed-b15b-fe5a21adb857",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "event",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Event"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1776,
        2896
      ],
      "id": "1ba15b73-6301-4210-ae89-cd887aacdfbb",
      "name": "Switch"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2480,
        3984
      ],
      "id": "4b1cb96e-96bb-469f-86ec-893b88edfbd8",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -224,
        2832
      ],
      "id": "4df6e959-f918-43c6-8bc8-67244f73ca5f",
      "name": "Keyword generator",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -96,
        3024
      ],
      "id": "7acef963-f7d5-4e95-b53f-d8b0f96f7407",
      "name": "Output parser",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {
          "webSearch": {
            "searchContextSize": "medium",
            "country": "US"
          }
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        336,
        2944
      ],
      "id": "5a3534e2-1fd2-49b0-9dd8-8d4c9f350fe5",
      "name": "Web Search",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"people_search\": {\n      \"type\": \"array\",\n      \"maxItems\": 25,\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"query\": { \"type\": \"string\" },\n          \"links\": {\n            \"type\": \"array\",\n            \"maxItems\": 5,\n            \"items\": {\n              \"type\": \"object\",\n              \"additionalProperties\": false,\n              \"properties\": {\n                \"title\": { \"type\": \"string\" },\n                \"url\": { \"type\": \"string\" },\n                \"source\": { \"type\": \"string\" },\n                \"snippet\": { \"type\": \"string\" }\n              },\n              \"required\": [\"title\", \"url\", \"source\", \"snippet\"]\n            }\n          }\n        },\n        \"required\": [\"query\", \"links\"]\n      }\n    },\n    \"company_search\": {\n      \"type\": \"array\",\n      \"maxItems\": 25,\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"query\": { \"type\": \"string\" },\n          \"links\": {\n            \"type\": \"array\",\n            \"maxItems\": 5,\n            \"items\": {\n              \"type\": \"object\",\n              \"additionalProperties\": false,\n              \"properties\": {\n                \"title\": { \"type\": \"string\" },\n                \"url\": { \"type\": \"string\" },\n                \"source\": { \"type\": \"string\" },\n                \"snippet\": { \"type\": \"string\" }\n              },\n              \"required\": [\"title\", \"url\", \"source\", \"snippet\"]\n            }\n          }\n        },\n        \"required\": [\"query\", \"links\"]\n      }\n    },\n    \"updates_search\": {\n      \"type\": \"array\",\n      \"maxItems\": 25,\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"query\": { \"type\": \"string\" },\n          \"links\": {\n            \"type\": \"array\",\n            \"maxItems\": 5,\n            \"items\": {\n              \"type\": \"object\",\n              \"additionalProperties\": false,\n              \"properties\": {\n                \"title\": { \"type\": \"string\" },\n                \"url\": { \"type\": \"string\" },\n                \"source\": { \"type\": \"string\" },\n                \"snippet\": { \"type\": \"string\" }\n              },\n              \"required\": [\"title\", \"url\", \"source\", \"snippet\"]\n            }\n          }\n        },\n        \"required\": [\"query\", \"links\"]\n      }\n    },\n    \"events_search\": {\n      \"type\": \"array\",\n      \"maxItems\": 20,\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"event_keyword\": { \"type\": \"string\" },\n          \"query\": { \"type\": \"string\" },\n          \"links\": {\n            \"type\": \"array\",\n            \"maxItems\": 5,\n            \"items\": {\n              \"type\": \"object\",\n              \"additionalProperties\": false,\n              \"properties\": {\n                \"title\": { \"type\": \"string\" },\n                \"url\": { \"type\": \"string\" },\n                \"source\": { \"type\": \"string\" },\n                \"snippet\": { \"type\": \"string\" }\n              },\n              \"required\": [\"title\", \"url\", \"source\", \"snippet\"]\n            }\n          }\n        },\n        \"required\": [\"event_keyword\", \"query\", \"links\"]\n      }\n    }\n  },\n  \"required\": [\"people_search\", \"company_search\", \"updates_search\", \"events_search\"]\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        432,
        2912
      ],
      "id": "b5cd6eb2-8b1e-4c2e-9261-8bdf144fda34",
      "name": "Structured Output Parser - Web Search"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        512,
        3120
      ],
      "id": "558685e3-f255-45cf-8155-9835e36d0bba",
      "name": "Output Parser",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing (common in sheets/web)\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"\";\n  return `li:post:${u}`;\n}\n\nfunction inferTypeFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"link\";\n  if (u.includes(\"linkedin.com/in/\")) return \"profile\";\n  if (u.includes(\"linkedin.com/company/\")) return \"company\";\n  if (u.includes(\"linkedin.com/posts/\") || u.includes(\"linkedin.com/feed/update/\")) return \"post\";\n  if (u.includes(\"eventbrite.com\") || u.includes(\"lu.ma\") || u.includes(\"meetup.com\")) return \"event\";\n  return \"link\";\n}\n// expects input item shaped like: { type:\"profile\", raw:{ data:{ profiles:[...] } } }\nconst out = [];\n\nfor (const item of $input.all()) {\n  const j = item.json || {};\n  const raw = j.raw || j;\n\n  const profiles =\n    raw?.data?.profiles ||\n    raw?.raw?.data?.profiles ||\n    raw?.output?.data?.profiles ||\n    [];\n\n  for (const p of (Array.isArray(profiles) ? profiles : [])) {\n    const url = cleanUrl(p.profile_url || p.url || \"\");\n    if (!url) continue;\n\n    out.push({\n      json: {\n        type: \"profile\",\n        target_url: url,\n        entity_key: profileKey(url) || url,   // fallback to url\n        source: \"linkup_profiles\",\n        raw: p\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        1920
      ],
      "id": "d93c4599-5622-45a0-bc09-899c2a6bcdf3",
      "name": "Standardize JSON Output"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing (common in sheets/web)\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"\";\n  return `li:post:${u}`;\n}\n\nfunction inferTypeFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"link\";\n  if (u.includes(\"linkedin.com/in/\")) return \"profile\";\n  if (u.includes(\"linkedin.com/company/\")) return \"company\";\n  if (u.includes(\"linkedin.com/posts/\") || u.includes(\"linkedin.com/feed/update/\")) return \"post\";\n  if (u.includes(\"eventbrite.com\") || u.includes(\"lu.ma\") || u.includes(\"meetup.com\")) return \"event\";\n  return \"link\";\n}\nconst out = [];\n\nfor (const item of $input.all()) {\n  const j = item.json || {};\n  const raw = j.raw || j;\n\n  const companies =\n    raw?.data?.companies ||\n    raw?.raw?.data?.companies ||\n    raw?.output?.data?.companies ||\n    raw?.data?.results || // fallback\n    [];\n\n  for (const c of (Array.isArray(companies) ? companies : [])) {\n    const url = cleanUrl(c.company_url || c.linkedin_url || c.url || \"\");\n    if (!url) continue;\n\n    out.push({\n      json: {\n        type: \"company\",\n        target_url: url,\n        entity_key: companyKey(url) || url,\n        source: \"linkup_companies\",\n        raw: c\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        2112
      ],
      "id": "e2f9fdfa-0562-4711-8f97-abe554c39997",
      "name": "Standardize JSON Output - Company"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing (common in sheets/web)\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"\";\n  return `li:post:${u}`;\n}\n\nfunction inferTypeFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"link\";\n  if (u.includes(\"linkedin.com/in/\")) return \"profile\";\n  if (u.includes(\"linkedin.com/company/\")) return \"company\";\n  if (u.includes(\"linkedin.com/posts/\") || u.includes(\"linkedin.com/feed/update/\")) return \"post\";\n  if (u.includes(\"eventbrite.com\") || u.includes(\"lu.ma\") || u.includes(\"meetup.com\")) return \"event\";\n  return \"link\";\n}\nconst out = [];\n\nfor (const item of $input.all()) {\n  const j = item.json || {};\n  const raw = j.raw || j;\n\n  const posts =\n    raw?.data?.posts ||\n    raw?.raw?.data?.posts ||\n    raw?.output?.data?.posts ||\n    [];\n\n  for (const p of (Array.isArray(posts) ? posts : [])) {\n    const shareUrl = cleanUrl(p.shareUrl || p.post_url || p.update_url || p.url || p.link || \"\");\n    const key = postKeyFromUrn(p.backend_urn) || postKeyFromUrl(shareUrl);\n\n    // also useful: actor profile key (for “post duplicates profile” logic later)\n    const actorUrl = cleanUrl(p.actor_profile_url || \"\");\n    const actorKey = profileKey(actorUrl) || companyKey(actorUrl) || \"\";\n\n    if (!shareUrl && !key) continue;\n\n    out.push({\n      json: {\n        type: \"post\",\n        target_url: shareUrl,\n        entity_key: key || shareUrl,\n        actor_entity_key: actorKey,\n        source: \"linkup_posts\",\n        raw: p\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        2304
      ],
      "id": "c0f36316-2d5d-4fb6-8b61-672bdbf48bae",
      "name": "Standardize JSON Output - Posts"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing (common in sheets/web)\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"\";\n  return `li:post:${u}`;\n}\n\nfunction inferTypeFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"link\";\n  if (u.includes(\"linkedin.com/in/\")) return \"profile\";\n  if (u.includes(\"linkedin.com/company/\")) return \"company\";\n  if (u.includes(\"linkedin.com/posts/\") || u.includes(\"linkedin.com/feed/update/\")) return \"post\";\n  if (u.includes(\"eventbrite.com\") || u.includes(\"lu.ma\") || u.includes(\"meetup.com\")) return \"event\";\n  return \"link\";\n}\n// \"Search for events\" actually returns LinkedIn posts under data.posts\nconst out = [];\n\nfunction cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  return url;\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfor (const item of $input.all()) {\n  const j = item.json || {};\n  const posts = j?.data?.posts || [];\n\n  for (const p of posts) {\n    const shareUrl = cleanUrl(p.shareUrl || p.post_url || p.update_url || p.url || p.link || \"\");\n    const key = postKeyFromUrn(p.backend_urn) || (shareUrl ? `li:post:${shareUrl}` : \"\");\n    const actorUrl = cleanUrl(p.actor_profile_url || \"\");\n    const actorKey = actorUrl ? profileKey(actorUrl) : \"\";\n\n    if (!shareUrl && !key) continue;\n\n    out.push({\n      json: {\n        type: \"event\",\n        target_url: shareUrl,\n        entity_key: key || shareUrl,\n        actor_entity_key: actorKey,\n        source: \"events_query_posts\", // so you know these posts came from the \"events\" query\n        raw: p\n      }\n    });\n  }\n}\n\nreturn out;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        2496
      ],
      "id": "30133791-c999-4d0b-a229-f37afc8b6ba3",
      "name": "Standardize JSON Output - Events",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing (common in sheets/web)\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"\";\n  return `li:post:${u}`;\n}\n\nfunction inferTypeFromUrl(url) {\n  const u = cleanUrl(url);\n  if (!u) return \"link\";\n  if (u.includes(\"linkedin.com/in/\")) return \"profile\";\n  if (u.includes(\"linkedin.com/company/\")) return \"company\";\n  if (u.includes(\"linkedin.com/posts/\") || u.includes(\"linkedin.com/feed/update/\")) return \"post\";\n  if (u.includes(\"eventbrite.com\") || u.includes(\"lu.ma\") || u.includes(\"meetup.com\")) return \"event\";\n  return \"link\";\n}\nconst input = $input.first().json;\nconst data = input.output ? input.output : input;\n\nconst out = [];\n\nfunction pushLinks(defaultType, entries, extra = {}) {\n  if (!Array.isArray(entries)) return;\n\n  for (const e of entries) {\n    const query = e.query || \"\";\n    const links = Array.isArray(e.links) ? e.links : [];\n\n    for (const l of links) {\n      const url = cleanUrl(l.url || \"\");\n      if (!url) continue;\n\n      // infer more precise type from URL (linkedin in/company/posts etc)\n      const inferred = inferTypeFromUrl(url);\n      const type = inferred !== \"link\" ? inferred : defaultType;\n\n      // entity_key based on type\n      let entity_key = \"\";\n      if (type === \"profile\") entity_key = profileKey(url) || url;\n      else if (type === \"company\") entity_key = companyKey(url) || url;\n      else if (type === \"post\") entity_key = postKeyFromUrl(url);\n      else if (type === \"event\") entity_key = `event:${url}`;\n      else entity_key = `url:${url}`;\n\n      out.push({\n        json: {\n          type,\n          target_url: url,\n          entity_key,\n          title: l.title || \"\",\n          source: l.source || \"\",\n          snippet: l.snippet || \"\",\n          query,\n          ...extra,\n          raw: l\n        }\n      });\n    }\n  }\n}\n\npushLinks(\"people\", data.people_search);\npushLinks(\"company\", data.company_search);\npushLinks(\"updates\", data.updates_search);\n\nif (Array.isArray(data.events_search)) {\n  for (const e of data.events_search) {\n    pushLinks(\"event\", [e], { event_keyword: e.event_keyword || \"\" });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        2688
      ],
      "id": "09416ce3-32bd-4d29-bfb7-5ff23837cc1f",
      "name": "Standardize JSON Output - Web Search"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {
          "webSearch": {
            "searchContextSize": "medium"
          }
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        5424,
        1536
      ],
      "id": "812a7c64-9d9f-4dca-a26c-11adff426e49",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"company_linkedin_url\": \"\",\n  \"company_name\": \"\",\n  \"company_url\": \"\",\n  \"what_they_do\": \"\",\n  \"products_services\": [],\n  \"target_customers\": [],\n  \"industries\": [],\n  \"geographies\": [],\n  \"leadership\": [],\n  \"contact_methods\": [],\n  \"notable_clients_or_partners\": [],\n  \"positioning_keywords\": [],\n  \"why_relevant_to_acuvity\": \"\",\n  \"confidence\": \"high|medium|low\",\n  \"sources\": []\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        5552,
        1536
      ],
      "id": "35df4b4e-5391-478a-ae03-932fde0984ef",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        5632,
        1744
      ],
      "id": "ac49e9ef-baf6-452b-88ad-b38aa97a00ef",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n\nconst out = [];\n\nfunction companySlugFromUrl(url) {\n  const m = String(url || \"\").match(/linkedin\\.com\\/company\\/([^\\/\\?\\#]+)/i);\n  return m ? m[1].toLowerCase() : \"\";\n}\n\nfor (const item of $input.all()) {\n  // Resolve profile data payload\n  const d =\n    item.json?.data ??\n    item.json?.output?.data ??\n    item.json ??\n    {};\n\n  const exp = Array.isArray(d.experience) ? d.experience : [];\n\n  // ---- Pick current job ----\n  const currentCandidates = exp.filter(\n    (e) => !e?.end_date || String(e.end_date).trim() === \"\"\n  );\n\n  const pickLatestStart = (arr) =>\n    arr\n      .slice()\n      .sort((a, b) =>\n        String(b?.start_date ?? \"\").localeCompare(\n          String(a?.start_date ?? \"\")\n        )\n      )[0];\n\n  const current = currentCandidates.length\n    ? pickLatestStart(currentCandidates)\n    : exp[0] ?? {};\n\n  const currentCompanyUrl = String(current?.company_url ?? \"\").trim();\n\n  // ---- Previous company URLs (deduped, ordered) ----\n  const previousCompanyUrls = [];\n  const seen = new Set();\n\n  for (const e of exp) {\n    const url = String(e?.company_url ?? \"\").trim();\n    if (!url) continue;\n    if (currentCompanyUrl && url === currentCompanyUrl) continue;\n    if (seen.has(url)) continue;\n\n    seen.add(url);\n    previousCompanyUrls.push(url);\n  }\n\n  // ---- Final normalized output ----\n  out.push({\n    json: {\n      public_id: String(d.public_id ?? \"\"),\n      first_name: String(d.first_name ?? \"\"),\n      last_name: String(d.last_name ?? \"\"),\n      headline: String(d.headline ?? \"\"),\n      location: String(d.location ?? \"\"),\n      industry: String(d.industry ?? \"\"),\n      summary: String(d.summary ?? \"\"),\n      company: String(current?.company ?? \"\"),\n      title: String(current?.title ?? \"\"),\n      start_date: String(current?.start_date ?? \"\"),\n      end_date: String(current?.end_date ?? \"\"),\n\n      // ✅ KEEP EXACTLY AS BEFORE\n      target_url: currentCompanyUrl,\n\n      // ✅ ADDITIVE (does not replace target_url)\n      company_linkedin_url: currentCompanyUrl,\n      company_slug: companySlugFromUrl(currentCompanyUrl),\n\n      previous_company_url: previousCompanyUrls\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4976,
        1792
      ],
      "id": "ec5d1d8f-a0ea-4e40-8485-84ffe00560b7",
      "name": "Profile Normalized"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Company: {{$json.company}}\nLinkedIn URL: {{$json.target_url}}\n\nUsing ONLY the web search results in this step, return the company intelligence profile JSON.\nHard requirement: Copy the LinkedIn URL exactly into \"company_linkedin_url\".\nReturn JSON only.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an enterprise company-research assistant for B2B prospecting.\n\nGenerate a concise, factual “company intelligence profile” from ONLY the web search results provided in this step.\n\nRules:\n- Do NOT guess. If not supported by the provided results, output \"unknown\".\n- Output MUST be a SINGLE valid JSON object only (no markdown, no extra text).\n- Use EXACTLY the keys listed in the required JSON schema.\n- \"company_linkedin_url\" MUST be copied exactly from the input LinkedIn URL string.\n- If leadership/contact are not explicitly mentioned, use \"unknown\".\n- sources must be a list of domain names only (e.g., \"sony.com\", \"linkedin.com\").\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        5456,
        1312
      ],
      "id": "49fdc4f0-b88e-46ed-858e-fcc137b57daf",
      "name": "Company Web Profile",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "company",
        "operation": "get company info",
        "getCompanyParams": {
          "companyUrl": "={{ $json.target_url }}"
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        5200,
        2016
      ],
      "id": "59cd3a93-d8bd-496c-9c62-43edfa57d2fd",
      "name": "Company info",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "post",
        "operation": "search posts",
        "searchPostsParams": {
          "sort_by": "recent",
          "linkedin_url": "={{ $json.target_url }}",
          "total_results": 5
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        5200,
        2512
      ],
      "id": "17f4c41c-6af4-4030-aba9-a75c31c59f34",
      "name": "Company Posts Top 5",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        7200,
        2240
      ],
      "id": "2415e53e-591a-43c0-9045-a254fc42b752",
      "name": "OpenAI Chat Model8",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "post",
        "operation": "search posts",
        "searchPostsParams": {
          "sort_by": "recent",
          "linkedin_url": "={{ $json.target_url }}",
          "total_results": 5
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        4400,
        3488
      ],
      "id": "8e501ebe-d31a-414f-b245-418e2c8d9ec1",
      "name": "Company Posts Top ",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        4464,
        3312
      ],
      "id": "08d9e426-abae-4015-a3de-91bffdfb2bec",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {
          "webSearch": {
            "searchContextSize": "medium"
          }
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        4256,
        3104
      ],
      "id": "895aaca1-56c4-4084-b25f-bebb99f93d13",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        5568,
        3104
      ],
      "id": "ccb89533-1dcc-487f-ab6a-f167f887f1de",
      "name": "OpenAI Chat Model11",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        5920,
        3072
      ],
      "id": "08625572-3d44-42fd-8975-2c08e9369530",
      "name": "OpenAI Chat Model12",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"lead_assessment\": {\n    \"is_potential_lead\": true,\n    \"lead_score\": 0,\n    \"lead_tier\": \"Hot|Warm|Cold\",\n    \"why_this_is_a_lead\": \"\",\n    \"key_buying_signals\": [],\n    \"recommended_contact\": { \"role\": \"\", \"reason\": \"\" },\n    \"sales_pitch\": \"\",\n    \"suggested_next_step\": \"\",\n    \"confidence\": \"high|medium|low\"\n  }\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        6048,
        3072
      ],
      "id": "beefb8a1-fa20-4c98-8104-db5078c641e2",
      "name": "Structured Output Parser4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        6128,
        3280
      ],
      "id": "949e35eb-e7bb-494b-8e6c-054b01cb0703",
      "name": "OpenAI Chat Model13",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        3760,
        3456
      ],
      "id": "326f3e93-3100-47e0-a802-ebbe5b6a2218",
      "name": "OpenAI Chat Model14",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2976,
        3824
      ],
      "id": "02dc701e-8af5-44c9-b021-3157bb60307e",
      "name": "OpenAI Chat Model15",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {
          "webSearch": {
            "searchContextSize": "medium"
          }
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2336,
        4592
      ],
      "id": "321478e7-c1a4-4d0a-a66b-bcb4120c18e2",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"event_name\": \"string\",\n  \"event_type\": \"string\",\n  \"event_url\": \"string\",\n  \"organizer_name\": \"string\",\n  \"organizer_type\": \"company | nonprofit | academic | unknown\",\n  \"event_focus\": [\"string\"],\n  \"industries_targeted\": [\"string\"],\n  \"primary_topics\": [\"string\"],\n  \"attendee_profile\": \"string\",\n  \"enterprise_ai_relevance\": \"high | medium | low\",\n  \"why_relevant\": \"string\",\n  \"location\": \"string\",\n  \"event_date\": \"string\",\n  \"source_urls\": [\"string\"]\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2464,
        4592
      ],
      "id": "6d100475-18e6-40e4-a507-40b63d0bdd42",
      "name": "Structured Output Parser5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2544,
        4800
      ],
      "id": "8c58d4c9-4f2d-4053-b1d8-3edf5966f956",
      "name": "OpenAI Chat Model16",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        3040,
        4976
      ],
      "id": "3caa2a44-651d-4442-9a47-4757113cf1e5",
      "name": "OpenAI Chat Model18",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"event_name\": \"string\",\n  \"event_url\": \"string\",\n  \"lead_rank\": \"string\",\n  \"confidence\": \"string\",\n  \"why_this_event_is_ranked_this_way\": \"string\",\n  \"key_enterprise_signals\": [\"string\"],\n  \"missing_or_weak_signals\": [\"string\"],\n  \"recommended_people_to_connect_with\": [\n    {\n      \"name\": \"string\",\n      \"role\": \"string\",\n      \"why_relevant\": \"string\"\n    }\n  ],\n  \"recommended_actions\": [\"string\"],\n  \"notes\": \"string\"\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2960,
        4768
      ],
      "id": "cee41834-4c53-464c-a009-fb37d5a921ea",
      "name": "Structured Output Parser6"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2832,
        4768
      ],
      "id": "3f1f063a-bb5d-437b-9ed4-43c8f795a902",
      "name": "OpenAI Chat Model17",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mergeByFields": {
          "values": [
            {
              "field1": "entity_key",
              "field2": "entity_key"
            }
          ]
        },
        "resolve": "preferInput1",
        "options": {}
      },
      "type": "n8n-nodes-base.compareDatasets",
      "typeVersion": 2.3,
      "position": [
        1392,
        2960
      ],
      "id": "20f3ac09-f5f6-48fd-9f25-3958bdf822d3",
      "name": "Compare Datasets"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 737582662,
          "mode": "list",
          "cachedResultName": "People",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=737582662"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        3152
      ],
      "id": "f0add69d-7a18-4f5e-b998-6ad0b8b31e38",
      "name": "People Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 2000131607,
          "mode": "list",
          "cachedResultName": "Company",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=2000131607"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        3344
      ],
      "id": "4921a285-f69c-4a90-8f7f-7b2951320470",
      "name": "Company Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 389004606,
          "mode": "list",
          "cachedResultName": "Events",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=389004606"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        3536
      ],
      "id": "b2bd8f70-cd01-4241-829b-202e5604fe00",
      "name": "Events Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "People",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        3728
      ],
      "id": "f0d792df-d7fa-498b-a0d7-9782e586fefb",
      "name": "Unwanted People Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 710069432,
          "mode": "list",
          "cachedResultName": "Company",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=710069432"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        3920
      ],
      "id": "cec8fba5-5c39-4265-b60a-c830a0bff6a9",
      "name": "Unwanted Company Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 884430569,
          "mode": "list",
          "cachedResultName": "Posts",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=884430569"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        4112
      ],
      "id": "ed492285-ddff-4c6a-9d63-89e80ebf75d9",
      "name": "Unwanted Posts Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  return u ? `li:post:${u}` : \"\";\n}\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n  const personUrl = cleanUrl(r.PERSON_PROFILE_URL || r.profile_url || r.linkedin_url || \"\");\n  if (!personUrl) continue;\n\n  out.push({\n    json: {\n      type: \"profile\",\n      target_url: personUrl,\n      entity_key: profileKey(personUrl) || personUrl,\n      source: \"sheet_people\",\n      raw: r\n    }\n  });\n\n  // Optional: also register their company as known (helps dedupe companies later)\n  const coUrl = cleanUrl(r.COMPANY_LINKEDIN_URL || \"\");\n  if (coUrl) {\n    out.push({\n      json: {\n        type: \"company\",\n        target_url: coUrl,\n        entity_key: companyKey(coUrl) || coUrl,\n        source: \"sheet_people_company_ref\",\n        raw: r\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        3152
      ],
      "id": "2952c39a-445f-484f-b2c9-e4f895c21a23",
      "name": "Standardize People Leads"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  return u ? `li:post:${u}` : \"\";\n}\n\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n  const coUrl = cleanUrl(r.COMPANY_LINKEDIN_URL || r.company_url || r.linkedin_url || \"\");\n  if (!coUrl) continue;\n\n  out.push({\n    json: {\n      type: \"company\",\n      target_url: coUrl,\n      entity_key: companyKey(coUrl) || coUrl,\n      source: \"sheet_company\",\n      raw: r\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        3344
      ],
      "id": "6b635eba-5f67-481f-bd0b-c4bac152dc6c",
      "name": "Standardize Company Leads"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  return u ? `li:post:${u}` : \"\";\n}\n\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n  const url = cleanUrl(r.event_url || r.EVENT_URL || r.url || \"\");\n  if (!url) continue;\n\n  out.push({\n    json: {\n      type: \"event\",\n      target_url: url,\n      entity_key: `event:${url}`,\n      source: \"sheet_events\",\n      raw: r\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        3536
      ],
      "id": "31153fbb-573d-4508-b22a-c1a73225d0ef",
      "name": "Standardize Event Leads"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction tryParseJsonString(v) {\n  if (typeof v !== \"string\") return null;\n  const s = v.trim();\n  if (!s) return null;\n  if (!(s.startsWith(\"{\") || s.startsWith(\"[\"))) return null;\n  try { return JSON.parse(s); } catch { return null; }\n}\n\nfunction collectObjects(value, acc) {\n  if (!value) return;\n  if (Array.isArray(value)) {\n    for (const x of value) collectObjects(x, acc);\n    return;\n  }\n  if (typeof value === \"object\") {\n    acc.push(value);\n    for (const v of Object.values(value)) collectObjects(v, acc);\n    return;\n  }\n  const parsed = tryParseJsonString(value);\n  if (parsed) collectObjects(parsed, acc);\n}\n\nfunction findUrlsEverywhere(obj) {\n  const objs = [];\n  collectObjects(obj, objs);\n\n  const found = new Set();\n\n  for (const o of objs) {\n    for (const v of Object.values(o)) {\n      if (typeof v === \"string\") {\n        // quick regex to pull linkedin urls out of long strings too\n        const matches = v.match(/https?:\\/\\/[^\\s\"']+/g) || [];\n        for (const m of matches) {\n          const u = cleanUrl(m);\n          if (u) found.add(u);\n        }\n\n        const u2 = cleanUrl(v);\n        if (u2) found.add(u2);\n      }\n    }\n  }\n\n  return [...found];\n}\n\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n\n  // First: use the explicit columns if present\n  const directPerson = cleanUrl(r.PERSON_PROFILE_URL || r.person_profile_url || r.profile_url || r.linkedin_url || \"\");\n  const directCompany = cleanUrl(r.COMPANY_LINKEDIN_URL || r.company_linkedin_url || r.company_url || \"\");\n\n  // Also: scan the whole row (handles JSON strings like r.person = \"{...}\")\n  const allUrls = findUrlsEverywhere(r);\n\n  const personUrls = new Set();\n  const companyUrls = new Set();\n\n  if (directPerson) personUrls.add(directPerson);\n  if (directCompany) companyUrls.add(directCompany);\n\n  for (const u of allUrls) {\n    if (u.includes(\"linkedin.com/in/\")) personUrls.add(u);\n    if (u.includes(\"linkedin.com/company/\")) companyUrls.add(u);\n  }\n\n  for (const u of personUrls) {\n    out.push({\n      json: {\n        type: \"profile\",\n        target_url: u,\n        entity_key: profileKey(u) || u,\n        source: \"skipped_people\",\n        raw: r\n      }\n    });\n  }\n\n  for (const u of companyUrls) {\n    out.push({\n      json: {\n        type: \"company\",\n        target_url: u,\n        entity_key: companyKey(u) || u,\n        source: \"skipped_people_company_ref\",\n        raw: r\n      }\n    });\n  }\n}\n\nreturn out; // returns [] if nothing found (NO more {})\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        3728
      ],
      "id": "9ef2cf1f-68b6-4d01-a46d-1c6fa50a25e4",
      "name": "Standardize Unwanted People Leads",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction tryParseJsonString(v) {\n  if (typeof v !== \"string\") return null;\n  const s = v.trim();\n  if (!s) return null;\n  if (!(s.startsWith(\"{\") || s.startsWith(\"[\"))) return null;\n  try { return JSON.parse(s); } catch { return null; }\n}\n\nfunction collectObjects(value, acc) {\n  if (!value) return;\n  if (Array.isArray(value)) {\n    for (const x of value) collectObjects(x, acc);\n    return;\n  }\n  if (typeof value === \"object\") {\n    acc.push(value);\n    for (const v of Object.values(value)) collectObjects(v, acc);\n    return;\n  }\n  const parsed = tryParseJsonString(value);\n  if (parsed) collectObjects(parsed, acc);\n}\n\nfunction findUrlsEverywhere(obj) {\n  const objs = [];\n  collectObjects(obj, objs);\n\n  const found = new Set();\n\n  for (const o of objs) {\n    for (const v of Object.values(o)) {\n      if (typeof v === \"string\") {\n        const matches = v.match(/https?:\\/\\/[^\\s\"']+/g) || [];\n        for (const m of matches) {\n          const u = cleanUrl(m);\n          if (u) found.add(u);\n        }\n        const u2 = cleanUrl(v);\n        if (u2) found.add(u2);\n      }\n    }\n  }\n  return [...found];\n}\n\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n\n  const direct = cleanUrl(r.COMPANY_LINKEDIN_URL || r.company_linkedin_url || r.company_url || r.linkedin_url || \"\");\n  const allUrls = findUrlsEverywhere(r);\n\n  const companyUrls = new Set();\n  if (direct) companyUrls.add(direct);\n\n  for (const u of allUrls) {\n    if (u.includes(\"linkedin.com/company/\")) companyUrls.add(u);\n  }\n\n  for (const u of companyUrls) {\n    out.push({\n      json: {\n        type: \"company\",\n        target_url: u,\n        entity_key: companyKey(u) || u,\n        source: \"skipped_company\",\n        raw: r\n      }\n    });\n  }\n}\n\nreturn out; // [] if none\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        3920
      ],
      "id": "db0c4f20-14d6-4ef6-a7f0-f3964e1d0fd8",
      "name": "Standardize Unwanted Company Leads"
    },
    {
      "parameters": {
        "jsCode": "function cleanUrl(u) {\n  let url = String(u || \"\").trim();\n  if (!url) return \"\";\n  url = url.replace(/^<|>$/g, \"\");\n\n  // add scheme if missing\n  if (/^www\\./i.test(url)) url = \"https://\" + url;\n  if (/^linkedin\\.com/i.test(url)) url = \"https://\" + url;\n\n  if (!/^https?:\\/\\//i.test(url)) return \"\";\n  url = url.toLowerCase().split(\"?\")[0].split(\"#\")[0];\n  url = url.replace(\"://www.\", \"://\").replace(/\\/+$/, \"\");\n  return url;\n}\n\nfunction profileKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/in\\/([^\\/]+)/i);\n  return m ? `li:in:${m[1]}` : \"\";\n}\n\nfunction companyKey(url) {\n  const u = cleanUrl(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/]+)/i);\n  return m ? `li:co:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrn(urn) {\n  const s = String(urn || \"\").toLowerCase();\n  const m = s.match(/activity:(\\d+)/);\n  return m ? `li:post:${m[1]}` : \"\";\n}\n\nfunction postKeyFromUrl(url) {\n  const u = cleanUrl(url);\n  return u ? `li:post:${u}` : \"\";\n}\nconst out = [];\n\nfor (const item of $input.all()) {\n  const r = item.json || {};\n\n  const url = cleanUrl(r.target_url || r.post_url || r.shareUrl || r.POST_URL || r.url || \"\");\n  const key = postKeyFromUrn(r.backend_urn || r.POST_URN || r.urn) || postKeyFromUrl(url);\n\n  // also capture actor if present (best dedupe signal)\n  const actorUrl = cleanUrl(r.actor_profile_url || r.ACTOR_PROFILE_URL || \"\");\n  const actorKey = actorUrl ? (profileKey(actorUrl) || companyKey(actorUrl) || \"\") : \"\";\n\n  if (!key && !url && !actorKey) continue;\n\n  out.push({\n    json: {\n      type: \"post\",\n      target_url: url,\n      entity_key: key || url,\n      actor_entity_key: actorKey,\n      source: \"skipped_posts\",\n      raw: r\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -256,
        4112
      ],
      "id": "87161246-f578-455d-afd3-32029e08fc34",
      "name": "Standardize Unwanted Posts Leads"
    },
    {
      "parameters": {
        "numberInputs": 6
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1040,
        3568
      ],
      "id": "348973a2-3955-4d5b-8e51-4029d762f50d",
      "name": "Merge Google Sheets"
    },
    {
      "parameters": {
        "numberInputs": 6
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1120,
        2272
      ],
      "id": "4b24d873-12f8-4cf3-8171-df1e2b5f0495",
      "name": "Merge Search content"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript): Clean company profile payloads\n\nfunction cleanText(s) {\n  let t = String(s || \"\").trim();\n  if (!t) return \"\";\n\n  // Remove common footer patterns like \"Make it real | www.capgemini.com\"\n  t = t.replace(/\\n{2,}/g, \"\\n\\n\");\n  t = t.replace(/\\|\\s*www\\.[^\\s]+/gi, \"\");\n  t = t.replace(/\\|\\s*https?:\\/\\/[^\\s]+/gi, \"\");\n  t = t.replace(/\\s+\\|\\s+$/g, \"\");\n  return t.trim();\n}\n\nfunction decodeAmp(url) {\n  return String(url || \"\").replace(/&amp;/g, \"&\").trim();\n}\n\nfunction nonEmptyAddress(addr) {\n  const a = addr || {};\n  const out = {};\n  if (a.country) out.country = a.country;\n  if (a.geographicArea) out.geographicArea = a.geographicArea;\n  if (a.city) out.city = a.city;\n  if (a.line1) out.line1 = a.line1;\n  if (a.line2) out.line2 = a.line2;\n  if (a.postalCode) out.postalCode = a.postalCode;\n  return Object.keys(out).length ? out : null;\n}\n\nfunction topLocations(locations, max = 5) {\n  if (!Array.isArray(locations)) return [];\n  const cleaned = [];\n\n  for (const loc of locations) {\n    const addr = nonEmptyAddress(loc?.address);\n    if (!addr) continue;\n\n    cleaned.push({\n      description: String(loc?.description || \"\").trim(),\n      headquarter: Boolean(loc?.headquarter),\n      address: addr\n    });\n\n    if (cleaned.length >= max) break;\n  }\n\n  return cleaned;\n}\n\nconst input = $input.all();\nconst out = [];\n\nfor (const item of input) {\n  // Your input appears to already be an array of company results in one item sometimes.\n  // Support both:\n  //  A) item.json is one {status,data}\n  //  B) item.json is an array of {status,data}\n  const rows = Array.isArray(item.json) ? item.json : [item.json];\n\n  for (const row of rows) {\n    if (!row || row.status !== \"success\") continue;\n\n    const d = row.data || {};\n    const slug = String(d.universalName || \"\").trim().toLowerCase();\n    const linkedinUrl = slug ? `https://linkedin.com/company/${slug}` : \"\";\n\n    const hq = d.headquarter || {};\n    const cleanedHq = nonEmptyAddress(hq);\n\n    const funding = d.funding || {};\n    const lastRound = funding.lastRound || null;\n\n    out.push({\n      json: {\n        company_name: String(d.name || \"\").trim(),\n        company_slug: slug,\n        company_linkedin_url: linkedinUrl,\n\n        website: String(d.websiteUrl || \"\").trim(),\n        industry: String(d.industry || \"\").trim(),\n        organization_type: String(d.organizationType || \"\").trim(),\n\n        employee_count: d.employeeCount ?? null,\n        followers_count: d.followersCount ?? null,\n\n        tagline: String(d.tagline || \"\").trim(),\n        description: cleanText(d.description || \"\"),\n\n        headquarter: cleanedHq,\n\n        logo_url: decodeAmp(d.logoUrl || \"\"),\n        cover_image_url: decodeAmp(d.coverImageUrl || \"\"),\n\n        top_locations: topLocations(d.locations, 5),\n\n        funding_last_round: lastRound\n          ? {\n              type: String(lastRound.type || \"\").trim(),\n              date: String(lastRound.date || \"\").trim(),\n              amount: String(lastRound.amount || \"\").trim()\n            }\n          : null\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5568,
        2016
      ],
      "id": "9ca2d613-8ad6-48b0-85be-03b0e76dc816",
      "name": "Company Normalized"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Lead Packet Builder — robust unwrapping + join by LinkedIn company slug\n *\n * INPUTS to this Code node should include streams for:\n * - Profile normalized (flat, has public_id + target_url (company LinkedIn URL))\n * - Company info cleaned (flat, has company_slug)\n * - Web company intel (often wrapped in { output: {...} } )\n * - Posts grouped (flat, has company_slug + posts[])\n */\n\nfunction norm(s) {\n  return String(s || \"\").trim();\n}\n\nfunction companySlugFromUrl(url) {\n  const m = String(url || \"\").match(/linkedin\\.com\\/company\\/([^\\/\\?\\#]+)/i);\n  return m ? m[1].toLowerCase() : \"\";\n}\n\n/**\n * Unwrap common n8n/agent/provider wrappers:\n * - { output: {...} }\n * - { data: {...} }\n * - { status: 'success', data: {...} }\n */\nfunction unwrap(j) {\n  if (!j || typeof j !== \"object\") return {};\n  if (j.output && typeof j.output === \"object\") return j.output;\n  if (j.data && typeof j.data === \"object\") return j.data;\n  return j;\n}\n\nconst rawItems = $input.all().map(it => it.json || {});\nconst items = rawItems.map(unwrap);\n\n// ---------- classify streams ----------\nconst profiles = [];\nconst companies = [];\nconst webIntels = [];\nconst postsGrouped = [];\n\n// classifiers use \"presence of fields\" (not node names)\nfor (const j of items) {\n  // profile normalized\n  if (j.public_id) {\n    profiles.push(j);\n    continue;\n  }\n\n  // posts grouped\n  if (j.company_slug && Array.isArray(j.posts)) {\n    postsGrouped.push(j);\n    continue;\n  }\n\n  // company cleaned info\n  if (j.company_slug && (j.website !== undefined || j.employee_count !== undefined || j.description !== undefined)) {\n    companies.push(j);\n    continue;\n  }\n\n  // web company intel (your agent output)\n  // accept either schema style: company_linkedin_url OR company_website etc.\n  if (\n    j.company_linkedin_url &&\n    (j.company_name !== undefined || j.what_they_do !== undefined || j.company_industry !== undefined)\n  ) {\n    webIntels.push(j);\n    continue;\n  }\n}\n\n// ---------- build lookup maps ----------\nconst companyBySlug = new Map();\nfor (const c of companies) {\n  const slug = norm(c.company_slug).toLowerCase();\n  if (!slug) continue;\n  if (!companyBySlug.has(slug)) companyBySlug.set(slug, c);\n}\n\nconst postsBySlug = new Map();\nfor (const pg of postsGrouped) {\n  const slug = norm(pg.company_slug).toLowerCase();\n  if (!slug) continue;\n  postsBySlug.set(slug, Array.isArray(pg.posts) ? pg.posts.slice(0, 5) : []);\n}\n\nconst webBySlug = new Map();\nfor (const w of webIntels) {\n  const slug = companySlugFromUrl(w.company_linkedin_url);\n  if (!slug) continue;\n  if (!webBySlug.has(slug)) webBySlug.set(slug, w);\n}\n\n// ---------- build packets ----------\nconst out = [];\n\nfor (const p of profiles) {\n  const companyLinkedinUrl = norm(p.company_linkedin_url || p.target_url || \"\");\n  const slug = companySlugFromUrl(companyLinkedinUrl);\n\n  const c = (slug && companyBySlug.get(slug)) || {};\n  const w = (slug && webBySlug.get(slug)) || {};\n  const posts = (slug && postsBySlug.get(slug)) || [];\n\n  out.push({\n    json: {\n      person: {\n        public_id: norm(p.public_id),\n        first_name: norm(p.first_name),\n        last_name: norm(p.last_name),\n        name: norm(p.name) || [p.first_name, p.last_name].filter(Boolean).join(\" \").trim(),\n        headline: norm(p.headline),\n        location: norm(p.location),\n        industry: norm(p.industry),\n        summary: p.summary ?? \"\",\n        current_role: p.current_role || {\n          title: norm(p.title),\n          company: norm(p.company),\n          start_date: norm(p.start_date),\n          end_date: norm(p.end_date)\n        },\n        previous_company_url: Array.isArray(p.previous_company_url) ? p.previous_company_url : [],\n        company_slug: slug || \"unknown\",\n        company_linkedin_url: companyLinkedinUrl\n      },\n\n      // company cleaned info (LinkedIn company object)\n      company_linkedin: {\n        company_name: c.company_name ?? norm(p.company),\n        company_slug: c.company_slug ?? (slug || \"\"),\n        company_linkedin_url: c.company_linkedin_url ?? companyLinkedinUrl,\n        website: c.website ?? \"\",\n        industry: c.industry ?? \"\",\n        organization_type: c.organization_type ?? \"\",\n        employee_count: c.employee_count ?? null,\n        followers_count: c.followers_count ?? null,\n        tagline: c.tagline ?? \"\",\n        description: c.description ?? \"\",\n        headquarter: c.headquarter ?? null,\n        top_locations: c.top_locations ?? [],\n        funding_last_round: c.funding_last_round ?? null,\n        logo_url: c.logo_url ?? \"\",\n        cover_image_url: c.cover_image_url ?? \"\"\n      },\n\n      // web company intel (your agent output; keep it as-is but normalize key names lightly)\n      company_web_profile: {\n        company_linkedin_url: w.company_linkedin_url ?? companyLinkedinUrl,\n        company_name: w.company_name ?? \"\",\n        company_url: w.company_url ?? w.company_website ?? \"\",\n        what_they_do: w.what_they_do ?? \"unknown\",\n\n        // allow both schemas (arrays or fields)\n        products_services: w.products_services ?? w.company_products ?? [],\n        target_customers: w.target_customers ?? [],\n        industries: w.industries ?? (w.company_industry ? [w.company_industry] : []),\n        geographies: w.geographies ?? (w.company_headquarters ? [w.company_headquarters] : []),\n        leadership:\n          w.leadership ??\n          (Array.isArray(w.company_leadership)\n            ? w.company_leadership.map(x => `${x.title || \"unknown\"} – ${x.name || \"unknown\"}`)\n            : []),\n        contact_methods:\n          w.contact_methods ??\n          (w.company_contact\n            ? Object.entries(w.company_contact)\n                .filter(([_, v]) => v && v !== \"unknown\")\n                .map(([k, v]) => `${k}: ${v}`)\n            : []),\n\n        notable_clients_or_partners: w.notable_clients_or_partners ?? [],\n        positioning_keywords: w.positioning_keywords ?? [],\n        why_relevant_to_acuvity: w.why_relevant_to_acuvity ?? \"\",\n        confidence: w.confidence ?? \"low\",\n        sources: w.sources ?? []\n      },\n\n      company_recent_posts: posts.map(r => ({\n        created_time: r.created_time ?? \"\",\n        url: r.url || r.shareUrl || \"\",\n        text: r.text ?? \"\",\n        likes: Number(r.likes ?? r.numLikes ?? 0),\n        comments: Number(r.comments ?? r.numComments ?? 0),\n        shares: Number(r.shares ?? r.numShares ?? 0),\n        backend_urn: r.backend_urn ?? \"\"\n      })),\n\n      join_debug: {\n        slug: slug || \"\",\n        has_company: Boolean(slug && companyBySlug.has(slug)),\n        has_web: Boolean(slug && webBySlug.has(slug)),\n        has_posts: Boolean(slug && postsBySlug.has(slug)),\n        company_inputs_seen: companies.length,\n        web_inputs_seen: webIntels.length,\n        posts_inputs_seen: postsGrouped.length\n      }\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5568,
        2512
      ],
      "id": "3d583495-00da-4f62-93b7-703e18b563cc",
      "name": "Company Posts Normalized"
    },
    {
      "parameters": {
        "numberInputs": 4
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        6064,
        1808
      ],
      "id": "3085b078-aaaa-4030-9ed5-2f259abfb44c",
      "name": "Merge Profile & Company info"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Build 1 Lead Packet per Profile from an APPENDED stream.\n *\n * Expected incoming item shapes:\n * 1) Profile normalized: { public_id, first_name, ..., target_url (company linkedin url), company, ... }\n * 2) Company LinkedIn cleaned: { company_slug, company_linkedin_url, company_name, ... }\n * 3) Web company intel (agent): { output: { company_linkedin_url, company_name, company_website, company_leadership, ... } }\n * 4) Posts grouped: { company_slug, company_linkedin_url, company_name, posts: [...] }\n */\n\nfunction norm(s) {\n  return String(s || \"\").trim();\n}\n\nfunction companySlugFromUrl(url) {\n  const m = String(url || \"\").match(/linkedin\\.com\\/company\\/([^\\/\\?\\#]+)/i);\n  return m ? m[1].toLowerCase() : \"\";\n}\n\nfunction unwrap(j) {\n  if (!j || typeof j !== \"object\") return {};\n  if (j.output && typeof j.output === \"object\") return j.output;           // <-- YOUR WEB INTEL\n  if (j.status && j.data && typeof j.data === \"object\") return j.data;     // provider shape\n  if (j.data && typeof j.data === \"object\") return j.data;\n  return j;\n}\n\nfunction isProfile(j) {\n  return Boolean(j.public_id && (j.target_url || j.company));\n}\n\nfunction isCompanyLinkedin(j) {\n  return Boolean(j.company_slug && (j.company_linkedin_url || j.website || j.description));\n}\n\nfunction isPostsGrouped(j) {\n  return Boolean(j.company_slug && Array.isArray(j.posts));\n}\n\nfunction isWebIntel(j) {\n  // after unwrap, web intel has company_linkedin_url + company_name/company_website/etc\n  return Boolean(j.company_linkedin_url && (j.company_website !== undefined || j.company_specialties !== undefined || j.company_leadership !== undefined));\n}\n\n// ---------- collect + unwrap ----------\nconst raw = $input.all().map(it => it.json || {});\nconst all = raw.map(unwrap);\n\n// ---------- partition ----------\nconst profiles = [];\nconst companies = [];\nconst postsGroups = [];\nconst webIntels = [];\nconst unknown = [];\n\nfor (const j of all) {\n  if (isProfile(j)) profiles.push(j);\n  else if (isPostsGrouped(j)) postsGroups.push(j);\n  else if (isCompanyLinkedin(j)) companies.push(j);\n  else if (isWebIntel(j)) webIntels.push(j);\n  else unknown.push(j);\n}\n\n// ---------- maps ----------\nconst companyBySlug = new Map();\nfor (const c of companies) {\n  const slug = norm(c.company_slug).toLowerCase();\n  if (!slug) continue;\n  if (!companyBySlug.has(slug)) companyBySlug.set(slug, c);\n}\n\nconst postsBySlug = new Map();\nfor (const pg of postsGroups) {\n  const slug = norm(pg.company_slug).toLowerCase();\n  if (!slug) continue;\n  postsBySlug.set(slug, (pg.posts || []).slice(0, 5));\n}\n\nconst webBySlug = new Map();\nfor (const w of webIntels) {\n  const slug = companySlugFromUrl(w.company_linkedin_url);\n  if (!slug) continue;\n  if (!webBySlug.has(slug)) webBySlug.set(slug, w);\n}\n\n// ---------- output packets ----------\nconst out = [];\n\nfor (const p of profiles) {\n  const companyLinkedinUrl = norm(p.company_linkedin_url || p.target_url || \"\");\n  const slug = companySlugFromUrl(companyLinkedinUrl);\n\n  const c = (slug && companyBySlug.get(slug)) || {};\n  const w = (slug && webBySlug.get(slug)) || {};\n  const posts = (slug && postsBySlug.get(slug)) || [];\n\n  // normalize web intel -> your desired \"company_web_profile\" schema\n  const webProfile = {\n    company_linkedin_url: w.company_linkedin_url || companyLinkedinUrl,\n    company_name: w.company_name || \"\",\n    company_url: w.company_url || w.company_website || \"\",\n    what_they_do: w.what_they_do || \"unknown\",\n    products_services: w.products_services || w.company_products || [],\n    target_customers: w.target_customers || [],\n    industries: w.industries || (w.company_industry ? [w.company_industry] : []),\n    geographies: w.geographies || (w.company_headquarters ? [w.company_headquarters] : []),\n    leadership:\n      w.leadership ||\n      (Array.isArray(w.company_leadership)\n        ? w.company_leadership.map(x => `${x.title || \"unknown\"} – ${x.name || \"unknown\"}`)\n        : []),\n    contact_methods:\n      w.contact_methods ||\n      (w.company_contact\n        ? Object.entries(w.company_contact).map(([k, v]) => `${k}: ${v ?? \"unknown\"}`)\n        : []),\n    notable_clients_or_partners: w.notable_clients_or_partners || [],\n    positioning_keywords: w.positioning_keywords || [],\n    why_relevant_to_acuvity: w.why_relevant_to_acuvity || \"\",\n    confidence: w.confidence || \"low\",\n    sources: w.sources || []\n  };\n\n  out.push({\n    json: {\n      person: {\n        public_id: norm(p.public_id),\n        first_name: norm(p.first_name),\n        last_name: norm(p.last_name),\n        name: norm(p.name) || [p.first_name, p.last_name].filter(Boolean).join(\" \").trim(),\n        headline: norm(p.headline),\n        location: norm(p.location),\n        industry: norm(p.industry),\n        summary: p.summary || \"\",\n        current_role: p.current_role || {\n          title: norm(p.title),\n          company: norm(p.company),\n          start_date: norm(p.start_date),\n          end_date: norm(p.end_date)\n        },\n        previous_company_url: Array.isArray(p.previous_company_url) ? p.previous_company_url : [],\n        company_slug: slug || \"unknown\",\n        company_linkedin_url: companyLinkedinUrl\n      },\n\n      company_linkedin: {\n        company_name: c.company_name || norm(p.company),\n        company_slug: c.company_slug || slug || \"\",\n        company_linkedin_url: c.company_linkedin_url || companyLinkedinUrl,\n        website: c.website || \"\",\n        industry: c.industry || \"\",\n        organization_type: c.organization_type || \"\",\n        employee_count: c.employee_count ?? null,\n        followers_count: c.followers_count ?? null,\n        tagline: c.tagline || \"\",\n        description: c.description || \"\",\n        headquarter: c.headquarter ?? null,\n        top_locations: c.top_locations || [],\n        funding_last_round: c.funding_last_round ?? null,\n        logo_url: c.logo_url || \"\",\n        cover_image_url: c.cover_image_url || \"\"\n      },\n\n      company_web_profile: webProfile,\n\n      company_recent_posts: posts.map(r => ({\n        created_time: r.created_time ?? \"\",\n        url: r.url || r.shareUrl || \"\",\n        text: r.text || \"\",\n        likes: Number(r.likes ?? r.numLikes ?? 0),\n        comments: Number(r.comments ?? r.numComments ?? 0),\n        shares: Number(r.shares ?? r.numShares ?? 0),\n        backend_urn: r.backend_urn || \"\"\n      })),\n\n      join_debug: {\n        slug,\n        has_company: Boolean(slug && companyBySlug.has(slug)),\n        has_web: Boolean(slug && webBySlug.has(slug)),\n        has_posts: Boolean(slug && postsBySlug.has(slug)),\n        inputs_seen: {\n          profiles: profiles.length,\n          companies: companies.length,\n          webIntels: webIntels.length,\n          postsGroups: postsGroups.length,\n          unknown: unknown.length\n        }\n      }\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6416,
        1840
      ],
      "id": "3bffed06-9ac0-4db5-8b6a-2db26de1b3f9",
      "name": "Create Lead Packet",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "inputText": "={{ $json }}",
        "categories": {
          "categories": [
            {
              "category": "potential_lead",
              "description": "The input represents a potential B2B lead for Acuvity if the person and their company show credible relevance to enterprise AI, data platforms, GenAI deployment, governance, or security.  A potential lead typically includes one or more of the following: - Senior or decision-influencing role (Director, VP, Head, C-level, Principal, Architect) - Responsibility for AI, ML, data platforms, cloud, security, governance, or enterprise systems - Company operating at enterprise scale or in data-heavy / regulated industries - Public signals of AI adoption, data strategy, platform modernization, or security focus  If these signals are weak, missing, or unrelated to enterprise AI or data systems, it should NOT be classified as a potential lead."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "You are a B2B lead qualification assistant.\n\nYour task is to classify the provided JSON lead packet into one of the following categories: {categories}.\n\nThe input is a structured lead packet containing:\n- Person profile and role\n- Company LinkedIn information\n- Company web intelligence\n- Recent company activity/posts\n\nClassify as \"potential_lead\" ONLY if the person and company show credible relevance to enterprise AI, data platforms, GenAI deployment, governance, or security.\n\nEvaluation criteria:\n- Person’s role seniority and influence\n- Company scale, industry, and technology focus\n- Evidence of AI, data, platform, or governance responsibility\n- Signals from company description and recent posts\n\nIf relevance is unclear, weak, or missing, do NOT classify as potential_lead.\n\nOutput JSON only.\nDo not explain.",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        6640,
        1840
      ],
      "id": "9ac692b4-d94a-4a3d-891d-acb18ba68ae3",
      "name": "Classify potential lead - People"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        6720,
        2064
      ],
      "id": "9d89108d-d348-433e-88ec-43d938f52787",
      "name": "Classify Potential Lead",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You will be given a lead packet JSON.\n\nTask:\n1) DO NOT modify, rewrite, or replace any part of the lead packet.\n2) Create a lead assessment for this exact packet.\n\nINPUT_LEAD_PACKET_JSON:\n{{ JSON.stringify($json.lead_packet ?? $json, null, 2) }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a B2B sales qualification analyst.\n\nHard rules:\n- You MUST evaluate ONLY the provided INPUT_LEAD_PACKET_JSON.\n- You MUST NOT invent a different person or company.\n- You MUST NOT replace the lead_packet with a new one.\n- You MUST preserve the lead packet exactly as-is.\n\nOutput MUST be valid JSON only, with EXACTLY these top-level keys:\n{\n  \"lead_assessment\": {\n    \"is_potential_lead\": true,\n    \"lead_score\": 0,\n    \"lead_tier\": \"Hot|Warm|Cold\",\n    \"why_this_is_a_lead\": \"\",\n    \"key_buying_signals\": [],\n    \"recommended_contact\": { \"role\": \"\", \"reason\": \"\" },\n    \"sales_pitch\": \"\",\n    \"suggested_next_step\": \"\",\n    \"confidence\": \"high|medium|low\"\n  }\n}\n\n\nImportant:\n- lead_packet must be the same structure and values as the input.\n- If something is missing in the packet, say \"unknown\" in assessment fields, do not guess.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        7024,
        1808
      ],
      "id": "890431ba-f8fe-44c4-a517-a1fbb530058a",
      "name": "Rank & Create sales pitch - Profile",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        6992,
        2032
      ],
      "id": "89f47fcb-6096-45aa-abea-6ccaeb933cc8",
      "name": "Rank & create sales pitch - Profile",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"lead_assessment\": {\n    \"is_potential_lead\": true,\n    \"lead_score\": 0,\n    \"lead_tier\": \"Hot|Warm|Cold\",\n    \"why_this_is_a_lead\": \"\",\n    \"key_buying_signals\": [],\n    \"recommended_contact\": { \"role\": \"\", \"reason\": \"\" },\n    \"sales_pitch\": \"\",\n    \"suggested_next_step\": \"\",\n    \"confidence\": \"high|medium|low\"\n  }\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        7120,
        2032
      ],
      "id": "48044d67-397f-4ef5-b759-9f823fd435ad",
      "name": "Structured Output Parser - Profile Sales pitch"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Input shape expected per item:\n * {\n *   output: { lead_assessment: {...} },\n *   person: {...},\n *   company_linkedin: {...},\n *   company_web_profile: {...},\n *   company_recent_posts: [...],\n *   join_debug: {...}\n * }\n *\n * Output: 1 flat row with ALL UPPERCASE keys (Google Sheets friendly)\n */\n\nfunction cleanStr(v) {\n  if (v === null || v === undefined) return \"\";\n  return String(v)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\n+/g, \" • \")\n    .replace(/\\t+/g, \" \")\n    .replace(/\\s{2,}/g, \" \")\n    .trim();\n}\n\nfunction joinArr(v, sep = \" | \") {\n  if (!Array.isArray(v)) return \"\";\n  return v.map((x) => cleanStr(x)).filter(Boolean).join(sep);\n}\n\nfunction boolToStr(v) {\n  if (v === true) return \"TRUE\";\n  if (v === false) return \"FALSE\";\n  if (v === null || v === undefined) return \"\";\n  const s = String(v).trim().toUpperCase();\n  if (s === \"TRUE\" || s === \"FALSE\") return s;\n  return s;\n}\n\nfunction personProfileUrl(person) {\n  const pid = cleanStr(person?.public_id);\n  if (!pid) return \"\";\n  // If pid already looks like a URL, keep it\n  if (pid.startsWith(\"http://\") || pid.startsWith(\"https://\")) return pid;\n  return `https://www.linkedin.com/in/${pid}`;\n}\n\nfunction hqString(hq) {\n  if (!hq || typeof hq !== \"object\") return \"\";\n  const parts = [\n    cleanStr(hq.line1),\n    cleanStr(hq.city),\n    cleanStr(hq.geographicArea),\n    cleanStr(hq.country),\n    cleanStr(hq.postalCode),\n  ].filter(Boolean);\n  return parts.join(\", \");\n}\n\nfunction fundingString(f) {\n  if (!f || typeof f !== \"object\") return \"\";\n  const parts = [cleanStr(f.type), cleanStr(f.amount), cleanStr(f.date)].filter(Boolean);\n  return parts.join(\" | \");\n}\n\nfunction postsToString(posts) {\n  if (!Array.isArray(posts) || posts.length === 0) return \"\";\n  return posts\n    .slice(0, 5)\n    .map((p) => {\n      const t = cleanStr(p.text || \"\");\n      const url = cleanStr(p.url || p.shareUrl || \"\");\n      const likes = p.likes ?? p.numLikes ?? \"\";\n      const when = p.created_time ?? \"\";\n      return [when, likes, url, t].filter(Boolean).join(\" | \");\n    })\n    .join(\" || \");\n}\n\nreturn $input.all().map((item) => {\n  const j = item.json || {};\n\n  const person = j.person || {};\n  const role = person.current_role || {};\n  const companyL = j.company_linkedin || {};\n  const web = j.company_web_profile || {};\n  const assess = j.output?.lead_assessment || {};\n  const join = j.join_debug || {};\n\n  const row = {\n    // ---- IDENTITY / LINKS FIRST ----\n    PERSON_NAME: cleanStr(person.name),\n    PERSON_COMPANY: cleanStr(role.company || companyL.company_name || web.company_name),\n    PERSON_PROFILE_URL: cleanStr(personProfileUrl(person)),\n    COMPANY_LINKEDIN_URL: cleanStr(companyL.company_linkedin_url || person.company_linkedin_url || web.company_linkedin_url),\n\n    // ---- LEAD ASSESSMENT ----\n    IS_POTENTIAL_LEAD: boolToStr(assess.is_potential_lead),\n    LEAD_SCORE: cleanStr(assess.lead_score),\n    LEAD_TIER: cleanStr(assess.lead_tier),\n    WHY_THIS_IS_A_LEAD: cleanStr(assess.why_this_is_a_lead),\n    KEY_BUYING_SIGNALS: Array.isArray(assess.key_buying_signals)\n      ? joinArr(assess.key_buying_signals, \" | \")\n      : cleanStr(assess.key_buying_signals),\n    RECOMMENDED_CONTACT_ROLE: cleanStr(assess.recommended_contact?.role),\n    RECOMMENDED_CONTACT_REASON: cleanStr(assess.recommended_contact?.reason),\n    SALES_PITCH: cleanStr(assess.sales_pitch),\n    SUGGESTED_NEXT_STEP: cleanStr(assess.suggested_next_step),\n    CONFIDENCE: cleanStr(assess.confidence),\n\n    // ---- PERSON DETAILS ----\n    PERSON_PUBLIC_ID: cleanStr(person.public_id),\n    PERSON_FIRST_NAME: cleanStr(person.first_name),\n    PERSON_LAST_NAME: cleanStr(person.last_name),\n    PERSON_TITLE: cleanStr(role.title),\n    PERSON_LOCATION: cleanStr(person.location),\n    PERSON_INDUSTRY: cleanStr(person.industry),\n    PERSON_HEADLINE: cleanStr(person.headline),\n    PERSON_SUMMARY: cleanStr(person.summary),\n    PERSON_START_DATE: cleanStr(role.start_date),\n    PERSON_END_DATE: cleanStr(role.end_date),\n    PREVIOUS_COMPANY_URL: joinArr(person.previous_company_url, \" | \"),\n    COMPANY_SLUG: cleanStr(person.company_slug),\n\n    // ---- COMPANY (LINKEDIN INFO) ----\n    COMPANY_NAME: cleanStr(companyL.company_name || role.company || web.company_name),\n    COMPANY_WEBSITE: cleanStr(companyL.website),\n    COMPANY_INDUSTRY: cleanStr(companyL.industry),\n    COMPANY_ORGANIZATION_TYPE: cleanStr(companyL.organization_type),\n    COMPANY_EMPLOYEE_COUNT: cleanStr(companyL.employee_count),\n    COMPANY_FOLLOWERS_COUNT: cleanStr(companyL.followers_count),\n    COMPANY_TAGLINE: cleanStr(companyL.tagline),\n    COMPANY_DESCRIPTION: cleanStr(companyL.description),\n    COMPANY_HQ: hqString(companyL.headquarter),\n    COMPANY_TOP_LOCATIONS: Array.isArray(companyL.top_locations)\n      ? joinArr(companyL.top_locations.map((x) => x?.address?.line1 || x?.description || \"\"), \" | \")\n      : \"\",\n    COMPANY_FUNDING_LAST_ROUND: fundingString(companyL.funding_last_round),\n    COMPANY_LOGO_URL: cleanStr(companyL.logo_url),\n    COMPANY_COVER_IMAGE_URL: cleanStr(companyL.cover_image_url),\n\n    // ---- WEB INTEL ----\n    WEB_COMPANY_URL: cleanStr(web.company_url),\n    WEB_WHAT_THEY_DO: cleanStr(web.what_they_do),\n    WEB_PRODUCTS_SERVICES: joinArr(web.products_services, \" | \"),\n    WEB_TARGET_CUSTOMERS: joinArr(web.target_customers, \" | \"),\n    WEB_INDUSTRIES: joinArr(web.industries, \" | \"),\n    WEB_GEOGRAPHIES: joinArr(web.geographies, \" | \"),\n    WEB_LEADERSHIP: joinArr(web.leadership, \" | \"),\n    WEB_CONTACT_METHODS: joinArr(web.contact_methods, \" | \"),\n    WEB_NOTABLE_CLIENTS_OR_PARTNERS: joinArr(web.notable_clients_or_partners, \" | \"),\n    WEB_POSITIONING_KEYWORDS: joinArr(web.positioning_keywords, \" | \"),\n    WEB_WHY_RELEVANT_TO_ACUVITY: cleanStr(web.why_relevant_to_acuvity),\n    WEB_CONFIDENCE: cleanStr(web.confidence),\n    WEB_SOURCES: joinArr(web.sources, \" | \"),\n\n    // ---- POSTS ----\n    COMPANY_RECENT_POSTS: postsToString(j.company_recent_posts),\n\n    // ---- JOIN DEBUG (OPTIONAL) ----\n    JOIN_SLUG: cleanStr(join.slug),\n    JOIN_HAS_COMPANY: boolToStr(join.has_company),\n    JOIN_HAS_WEB: boolToStr(join.has_web),\n    JOIN_HAS_POSTS: boolToStr(join.has_posts),\n  };\n\n  return { json: row };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7712,
        1664
      ],
      "id": "5e4645a8-6b3f-495a-abd6-518af18635b7",
      "name": "Structure lead packet for Sheets - Profile"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        7488,
        1664
      ],
      "id": "a84906fc-8050-4c59-92cd-cb6409f34eb9",
      "name": "Merge raw + Lead packet - Profile"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 737582662,
          "mode": "list",
          "cachedResultName": "People",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=737582662"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7936,
        1664
      ],
      "id": "7b06a174-e1fd-4760-bbcd-a70a3041b0f5",
      "name": "Profile Leads Sheet - Append",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.target_url }}",
                    "rightValue": "linkedin.com",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "6baff543-19b9-4495-a393-34fc754134be"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "LinkedIn Company"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6f318929-fc46-40c7-9860-de3c4b9cb82f",
                    "leftValue": "={{ $json.target_url }}",
                    "rightValue": "linkedin.com",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Web Search Company"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2480,
        2384
      ],
      "id": "047ec873-8c46-4821-ab5a-307b8acb52e8",
      "name": "Categorize companies"
    },
    {
      "parameters": {
        "inputText": "={{ \n  [\n    \"title: \" + ($json.title || \"\"),\n    \"snippet: \" + ($json.snippet || \"\"),\n    \"url: \" + ($json.target_url || \"\"),\n    \"source: \" + ($json.source || \"\")\n  ].join(\"\\n\")\n}}\n",
        "categories": {
          "categories": [
            {
              "category": "company",
              "description": "A company is a real, operating business or commercial organization that provides products, services, software, or platforms under a brand name. It has an independent business presence such as a company website, product pages, pricing, or descriptions of offerings sold to customers. Example signals include: “offers a platform”, “provides services”, “enterprise solution”, “customers”, “clients”."
            }
          ]
        },
        "options": {
          "fallback": "discard",
          "systemPromptTemplate": "Classify the input into one of the following categories: {categories}.\n\nRules:\n- Classify as \"company\" ONLY if the entity is a real business that sells or provides products, services, or platforms.\n- Do not infer intent. Use only the provided title, snippet, and URL.\n- Output JSON only. Do not explain.",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        2912,
        2224
      ],
      "id": "19250d0b-af4a-4767-bd5d-975569924404",
      "name": "Classify real company"
    },
    {
      "parameters": {
        "text": "={{ \n  [\n    \"title: \" + ($json.title || \"\"),\n    \"snippet: \" + ($json.snippet || \"\"),\n    \"url: \" + ($json.target_url || \"\"),\n    \"source: \" + ($json.source || \"\")\n  ].join(\"\\n\")\n}}",
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"type\": { \"type\": \"string\" },\n    \"target_url\": { \"type\": \"string\" },\n    \"company_name\": { \"type\": \"string\" }\n  },\n  \"required\": [\"company_name\"]\n}\n",
        "options": {
          "systemPromptTemplate": "You extract a company name from a search result.\n\nRules:\n- The company_name must be the organization the page is about (usually in the title or source).\n- Do NOT return job boards, alliances, reports, or publishers as the company unless the page is specifically about that publisher’s company offering.\n- Prefer the brand/company in the title before the source if both exist.\n- Return the clean company name only (no role titles, no extra words like “careers”, “job”, “AI governance for…”, no punctuation fluff).\n- If unsure, set company_name to \"unknown\".\n\nReturn JSON only."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        3328,
        2224
      ],
      "id": "6f3d6f3b-821c-44ca-8a5f-9759370620c2",
      "name": "Extract company name/url"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2976,
        2448
      ],
      "id": "8b582e2c-f253-416e-996f-9f77a5209bc2",
      "name": "Classify real company1",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        3408,
        2448
      ],
      "id": "9782c070-f4cc-4a67-83fe-830e297bad5b",
      "name": "Extract company name/url1",
      "credentials": {
        "openAiApi": {
          "id": "uPPMGRphCvYWSLUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "company",
        "searchCompaniesParams": {
          "keyword": "={{ $json.output.company_name }}",
          "total_results": 1
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        3744,
        2224
      ],
      "id": "2d821d1d-c470-4c21-8ac4-139f45a1ff9f",
      "name": "Search for companies info",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "resource": "company",
        "operation": "get company info",
        "getCompanyParams": {
          "companyUrl": "={{ $json.target_url }}"
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        4400,
        2688
      ],
      "id": "25b4a134-a37f-480e-a02c-c125911f426d",
      "name": "Get company info",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript): Clean company profile payloads\n\nfunction cleanText(s) {\n  let t = String(s || \"\").trim();\n  if (!t) return \"\";\n\n  // Remove common footer patterns like \"Make it real | www.capgemini.com\"\n  t = t.replace(/\\n{2,}/g, \"\\n\\n\");\n  t = t.replace(/\\|\\s*www\\.[^\\s]+/gi, \"\");\n  t = t.replace(/\\|\\s*https?:\\/\\/[^\\s]+/gi, \"\");\n  t = t.replace(/\\s+\\|\\s+$/g, \"\");\n  return t.trim();\n}\n\nfunction decodeAmp(url) {\n  return String(url || \"\").replace(/&amp;/g, \"&\").trim();\n}\n\nfunction nonEmptyAddress(addr) {\n  const a = addr || {};\n  const out = {};\n  if (a.country) out.country = a.country;\n  if (a.geographicArea) out.geographicArea = a.geographicArea;\n  if (a.city) out.city = a.city;\n  if (a.line1) out.line1 = a.line1;\n  if (a.line2) out.line2 = a.line2;\n  if (a.postalCode) out.postalCode = a.postalCode;\n  return Object.keys(out).length ? out : null;\n}\n\nfunction topLocations(locations, max = 5) {\n  if (!Array.isArray(locations)) return [];\n  const cleaned = [];\n\n  for (const loc of locations) {\n    const addr = nonEmptyAddress(loc?.address);\n    if (!addr) continue;\n\n    cleaned.push({\n      description: String(loc?.description || \"\").trim(),\n      headquarter: Boolean(loc?.headquarter),\n      address: addr\n    });\n\n    if (cleaned.length >= max) break;\n  }\n\n  return cleaned;\n}\n\nconst input = $input.all();\nconst out = [];\n\nfor (const item of input) {\n  // Your input appears to already be an array of company results in one item sometimes.\n  // Support both:\n  //  A) item.json is one {status,data}\n  //  B) item.json is an array of {status,data}\n  const rows = Array.isArray(item.json) ? item.json : [item.json];\n\n  for (const row of rows) {\n    if (!row || row.status !== \"success\") continue;\n\n    const d = row.data || {};\n    const slug = String(d.universalName || \"\").trim().toLowerCase();\n    const linkedinUrl = slug ? `https://linkedin.com/company/${slug}` : \"\";\n\n    const hq = d.headquarter || {};\n    const cleanedHq = nonEmptyAddress(hq);\n\n    const funding = d.funding || {};\n    const lastRound = funding.lastRound || null;\n\n    out.push({\n      json: {\n        company_name: String(d.name || \"\").trim(),\n        company_slug: slug,\n        company_linkedin_url: linkedinUrl,\n\n        website: String(d.websiteUrl || \"\").trim(),\n        industry: String(d.industry || \"\").trim(),\n        organization_type: String(d.organizationType || \"\").trim(),\n\n        employee_count: d.employeeCount ?? null,\n        followers_count: d.followersCount ?? null,\n\n        tagline: String(d.tagline || \"\").trim(),\n        description: cleanText(d.description || \"\"),\n\n        headquarter: cleanedHq,\n\n        logo_url: decodeAmp(d.logoUrl || \"\"),\n        cover_image_url: decodeAmp(d.coverImageUrl || \"\"),\n\n        top_locations: topLocations(d.locations, 5),\n\n        funding_last_round: lastRound\n          ? {\n              type: String(lastRound.type || \"\").trim(),\n              date: String(lastRound.date || \"\").trim(),\n              amount: String(lastRound.amount || \"\").trim()\n            }\n          : null\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4752,
        2688
      ],
      "id": "9a54795d-1670-425b-ac4a-3e23c83ba751",
      "name": "Standardize company info"
    },
    {
      "parameters": {
        "jsCode": "const output = [];\n\nfor (const item of items) {\n  const companies = item.json?.data?.companies || [];\n\n  for (const company of companies) {\n    output.push({\n      json: {\n        target_url: company.url || \"\",\n        raw: {title: company.title || \"\"},\n        description: company.description || \"\"\n      }\n    });\n  }\n}\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4032,
        2224
      ],
      "id": "f272bcad-c11b-41dd-980c-b6f6c6d2c9ab",
      "name": "Rename to target url"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Company: {{$json.raw.title}}\nLinkedIn URL: {{$json.target_url}}\n\nUsing ONLY the web search results in this step, return the company intelligence profile JSON.\nHard requirement: Copy the LinkedIn URL exactly into \"company_linkedin_url\".\nReturn JSON only.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an enterprise company-research assistant for B2B prospecting.\n\nGenerate a concise, factual “company intelligence profile” from ONLY the web search results provided in this step.\n\nRules:\n- Do NOT guess. If not supported by the provided results, output \"unknown\".\n- Output MUST be a SINGLE valid JSON object only (no markdown, no extra text).\n- Use EXACTLY the keys listed in the required JSON schema.\n- \"company_linkedin_url\" MUST be copied exactly from the input LinkedIn URL string.\n- If leadership/contact are not explicitly mentioned, use \"unknown\".\n- sources must be a list of domain names only (e.g., \"sony.com\", \"linkedin.com\").\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        4288,
        2880
      ],
      "id": "2bd033c8-367a-4490-a557-2503e8e871b3",
      "name": "Get Company profile from Web",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"company_linkedin_url\": \"\",\n  \"company_name\": \"\",\n  \"company_url\": \"\",\n  \"what_they_do\": \"\",\n  \"products_services\": [],\n  \"target_customers\": [],\n  \"industries\": [],\n  \"geographies\": [],\n  \"leadership\": [],\n  \"contact_methods\": [],\n  \"notable_clients_or_partners\": [],\n  \"positioning_keywords\": [],\n  \"why_relevant_to_acuvity\": \"\",\n  \"confidence\": \"high|medium|low\",\n  \"sources\": []\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        4384,
        3104
      ],
      "id": "ac48e775-587e-4102-be93-996bcc9ca86c",
      "name": "Get company profile from web"
    },
    {
      "parameters": {
        "text": "={{ JSON.stringify($json) }}",
        "attributes": {
          "attributes": [
            {
              "name": "person_name",
              "description": "Full name of the person mentioned in the text",
              "required": true
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        3680,
        3232
      ],
      "id": "47031046-e28a-433d-9ed6-21311cf358a6",
      "name": "Extract Name from Web search"
    },
    {
      "parameters": {
        "operation": "search profile",
        "searchProfileParams": {
          "keyword": "={{ $json.output.person_name }}",
          "total_results": 1
        },
        "advancedOptions": {}
      },
      "type": "n8n-nodes-linkupapi.linkup",
      "typeVersion": 1,
      "position": [
        4032,
        3232
      ],
      "id": "a505be90-115a-4f03-b49e-33f850356d5c",
      "name": "Search fro Profile on LinkedIn",
      "credentials": {
        "linkupApi": {
          "id": "JoTDh8JI0FyymSBp",
          "name": "LINKUP account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return $input.all().flatMap(item => {\n  const profiles = item.json?.data?.profiles || [];\n\n  return profiles.map(profile => ({\n    json: {\n      type: \"profile\",\n      target_url: profile.profile_url || \"\",\n      raw: profile\n    }\n  }));\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4400,
        3856
      ],
      "id": "3ab9514b-8154-4e3b-be74-013d90b40c97",
      "name": "Rename target url"
    },
    {
      "parameters": {
        "inputText": "={{ $json.text }}",
        "categories": {
          "categories": [
            {
              "category": "is_lead",
              "description": "Use this category only if the post describes a specific real company, product, or internal system that is actively deploying, operating, or evaluating GenAI (LLMs, RAG, copilots, agents) in production and explicitly mentions security, governance, compliance, monitoring, or risk controls tied to that deployment.\nAll of the following must be present\nConcrete enterprise GenAI usage\nClear first-party language such as: we deployed, in production, rolled out, launched, operating at scale, customer-facing AI, or internal AI system.\nOperational or buying context\nMentions of implementation, integration, audits, incidents, vendor evaluation, security reviews, procurement, platform ownership, or tooling decisions.\nSecurity / governance exposure\nExplicit references to AI security, prompt injection, jailbreaks, guardrails, policy enforcement, monitoring, audits (SOC2 / ISO / GRC), model risk, data leakage, or compliance controls.\nThe post must reference a real organization, product, or system doing the work.\nDo NOT classify as a lead if the post is\nHigh-level, strategic, educational, ethical, or speculative\nAI policy or regulation analysis\n“Responsible AI” or accountability discussions without tooling or enforcement\nThought leadership, executive advice, or macro/industry trends\nAcademic, government, or advisory commentary\nMissing a named company/system and concrete operational action\nHard gate (mandatory)\nClassify as lead only when the post is first-party and operational — the author or their organization describing their own deployment, evaluation, or implementation.\nIf the post reads like news, analysis, or an industry briefing (e.g., “sources report,” “the industry,” “policy updates”), it is not a lead.\nWhen in doubt, classify as not_lead."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "Please classify the text provided by the user into one of the following categories: {categories}, and use the provided formatting instructions below. Don't explain, and only output the json.",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        2416,
        3728
      ],
      "id": "ab01180c-03fc-4f30-807b-c40db7917816",
      "name": "Classify posts as potential lead",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "text": "={{ JSON.stringify($json) }}",
        "attributes": {
          "attributes": [
            {
              "name": "actor_type",
              "description": "Classify the actor as company if actor_profile_url contains /company/, otherwise person.",
              "required": true
            },
            {
              "name": "actor_name",
              "description": "The actor’s display name (person or company) from the post metadata (use actor_name).",
              "required": true
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        2912,
        3600
      ],
      "id": "ccdaabc1-40b8-43ac-a022-b20584139546",
      "name": "Extract Person Name/Company"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 884430569,
          "mode": "list",
          "cachedResultName": "Posts",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=884430569"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2976,
        4032
      ],
      "id": "e1ba60d5-7b5c-4b03-82ab-37ffec278f8f",
      "name": "Not Leads from Posts",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().map(item => {\n  const out = item.json?.output ?? item.json; // supports both shapes\n\n  const { actor_type, actor_name, ...restOut } = out;\n\n  const normalizedOut = {\n    ...restOut,\n    actor_type,\n    ...(actor_type === \"person\"\n      ? { person_name: actor_name }\n      : { company_name: actor_name }),\n  };\n\n  return {\n    json: {\n      ...item.json,\n      output: normalizedOut, // keep nesting\n    },\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3392,
        3696
      ],
      "id": "2eefaf11-3480-4b96-9365-11f546c2b248",
      "name": "Mention type"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.actor_type }}",
                    "rightValue": "person",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "da079e33-48ec-4af6-a1ae-dc722c0099d0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Profile"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2848619e-4526-468f-8d71-59dcdba575a8",
                    "leftValue": "={{ $json.output.actor_type }}",
                    "rightValue": "company",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Company"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        3744,
        3696
      ],
      "id": "5e62c4bf-f352-4db0-9a75-0b729e2f50b3",
      "name": "Switch - Person/Company"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are given the name  {{ $json.title }} or URL {{ $json.target_url }} of an event.\n\nSearch the web to gather accurate, up-to-date information about this event and build a structured B2B lead packet.\n\nFocus on:\n- What the event is about\n- Who is organizing it\n- Who typically attends or speaks\n- Whether the event is relevant to enterprise AI, GenAI, data platforms, governance, security, or regulated industries\n\nIf the event appears purely academic, generic, or unrelated to enterprise AI systems, still extract the details but mark it as low relevance.\n\nUse only factual information found via web search.\nDo not guess or invent details.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a B2B event intelligence and lead research assistant.\n\nYour task is to research events using web search and produce structured lead packets suitable for enterprise sales and outbound qualification.\n\nBe factual, conservative, and precise.\nPrefer verified sources such as the event website, LinkedIn, sponsors, or reputable tech media.\nIf information is missing, return null rather than guessing.\n\nOutput JSON only.\nDo not explain your reasoning.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2368,
        4368
      ],
      "id": "8ec62708-c9ce-48b6-8514-7d0fb00cfdd3",
      "name": "Search web for Event details"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are given the following event data as JSON. \n{{ JSON.stringify($json, null, 2) }}\nUsing ONLY this data:\n- Rank the event as a B2B lead for Acuvity (high, medium, or low)\n- Explain why it is ranked this way\n- Identify the most relevant people to connect with\n- Recommend next actions\n\nDo not perform web searches.\nDo not invent information.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a B2B event lead qualification and prioritization agent.\n\nYour role is to evaluate events strictly for enterprise sales relevance.\nPrefer concrete enterprise signals over general AI interest.\nBe conservative: default to low relevance unless strong evidence is present.\n\nDo not invent facts.\nDo not repeat raw input.\nSynthesize and judge.\n\nOutput JSON only.\nDo not explain your reasoning outside the JSON."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2864,
        4544
      ],
      "id": "aae9db58-f124-4b87-9721-402e80e72f71",
      "name": "Create lead packet"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        3392,
        4368
      ],
      "id": "d87d72b9-5c86-4629-a6c6-229890ca59d3",
      "name": "Merge raw + lead packet - Events"
    },
    {
      "parameters": {
        "jsCode": "function toStr(v) {\n  if (v === null || v === undefined) return \"\";\n  if (typeof v === \"string\") return v;\n  if (typeof v === \"number\" || typeof v === \"boolean\") return String(v);\n  return JSON.stringify(v);\n}\n\nfunction joinArr(arr) {\n  if (!Array.isArray(arr) || arr.length === 0) return \"\";\n  return arr.map(x => (typeof x === \"string\" ? x : JSON.stringify(x))).join(\" | \");\n}\n\nfunction joinSpeakers(arr) {\n  if (!Array.isArray(arr) || arr.length === 0) return \"\";\n  // Handles either {name,title,description} or strings\n  return arr.map(s => {\n    if (typeof s === \"string\") return s;\n    const name = s?.name ?? \"\";\n    const title = s?.title ?? s?.role ?? \"\";\n    return [name, title].filter(Boolean).join(\" — \");\n  }).join(\" | \");\n}\n\nfunction scorePacket(o) {\n  // pick the richest packet (more filled fields)\n  let score = 0;\n  const bump = (v, w=1) => { if (v !== null && v !== undefined && v !== \"\" && !(Array.isArray(v) && v.length === 0)) score += w; };\n  bump(o.eventName, 3);\n  bump(o.eventUrl, 3);\n  bump(o.description, 2);\n  bump(o.date, 1);\n  bump(o.location, 1);\n  bump(o.organizer?.name, 2);\n  bump(o.notableSpeakers, 2);\n  bump(o.typicalAttendees, 1);\n  bump(o.relevance, 1);\n  bump(o.rank, 2);\n  bump(o.reasoning, 2);\n  bump(o.mostRelevantPeople, 1);\n  bump(o.recommendedNextActions, 1);\n\n  // alternative shape\n  bump(o.event?.name, 2);\n  bump(o.event?.url, 2);\n\n  return score;\n}\n\nreturn $input.all().map(item => {\n  // In your merged object, you may have multiple \"outputs\" across combined items.\n  // If your merge created a single item with multiple keys, adapt here.\n  // But your sample shows item.json.output holds one packet at a time.\n  const o = item.json?.output ?? item.json;\n\n  // If output itself is an array of packets, pick the richest\n  const packets = Array.isArray(o) ? o : [o];\n  const best = packets.reduce((a,b) => (scorePacket(b) > scorePacket(a) ? b : a), packets[0] || {});\n\n  // Normalize name/url across both shapes\n  const event_name = best.eventName ?? best.event_name ?? best.name ?? best.event?.name ?? \"\";\n  const event_url  = best.eventUrl  ?? best.event_url  ?? best.url  ?? best.event?.url  ?? \"\";\n\n  const organizer_name = best.organizer?.name ?? best.organizer_name ?? \"\";\n  const organizer_url  = best.organizer?.url  ?? best.organizer_url  ?? \"\";\n\n  const row = {\n    event_name: toStr(event_name),\n    event_url: toStr(event_url),\n    date: toStr(best.date ?? best.event_date ?? \"\"),\n    location: toStr(best.location ?? \"\"),\n    format: toStr(best.format ?? \"\"), // if you have it later\n    organizer_name: toStr(organizer_name),\n    organizer_url: toStr(organizer_url),\n\n    description: toStr(best.description ?? best.about ?? \"\"),\n    relevance: joinArr(best.relevance),\n\n    lead_rank: toStr(best.rank ?? best.lead_rank ?? \"\"),\n    confidence: toStr(best.confidence ?? \"\"), // may be missing\n    why_ranked: toStr(best.reasoning ?? best.explanation ?? best.why_this_event_is_ranked_this_way ?? \"\"),\n\n    typical_attendees: joinArr(best.typicalAttendees),\n    notable_speakers: joinSpeakers(best.notableSpeakers),\n\n    recommended_people: Array.isArray(best.mostRelevantPeople)\n      ? joinArr(best.mostRelevantPeople)\n      : toStr(best.mostRelevantPeople ?? best.most_relevant_people ?? best.relevant_people_to_connect_with ?? \"\"),\n\n    recommended_actions: joinArr(best.recommendedNextActions ?? best.recommended_actions ?? best.next_actions ?? []),\n\n    processed_at_utc: new Date().toISOString(),\n  };\n\n  return { json: row };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3744,
        4368
      ],
      "id": "d2fac0ba-6f4f-41d2-abdf-ddb8976454f5",
      "name": "Prepare for Sheets"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 389004606,
          "mode": "list",
          "cachedResultName": "Events",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=389004606"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4032,
        4368
      ],
      "id": "0b6c510a-161e-49f6-8589-94261cc7cdc1",
      "name": "Events Leads1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Lead Packet Builder — robust unwrapping + join by LinkedIn company slug\n *\n * INPUTS to this Code node should include streams for:\n * - Profile normalized (flat, has public_id + target_url (company LinkedIn URL))\n * - Company info cleaned (flat, has company_slug)\n * - Web company intel (often wrapped in { output: {...} } )\n * - Posts grouped (flat, has company_slug + posts[])\n */\n\nfunction norm(s) {\n  return String(s || \"\").trim();\n}\n\nfunction companySlugFromUrl(url) {\n  const m = String(url || \"\").match(/linkedin\\.com\\/company\\/([^\\/\\?\\#]+)/i);\n  return m ? m[1].toLowerCase() : \"\";\n}\n\n/**\n * Unwrap common n8n/agent/provider wrappers:\n * - { output: {...} }\n * - { data: {...} }\n * - { status: 'success', data: {...} }\n */\nfunction unwrap(j) {\n  if (!j || typeof j !== \"object\") return {};\n  if (j.output && typeof j.output === \"object\") return j.output;\n  if (j.data && typeof j.data === \"object\") return j.data;\n  return j;\n}\n\nconst rawItems = $input.all().map(it => it.json || {});\nconst items = rawItems.map(unwrap);\n\n// ---------- classify streams ----------\nconst profiles = [];\nconst companies = [];\nconst webIntels = [];\nconst postsGrouped = [];\n\n// classifiers use \"presence of fields\" (not node names)\nfor (const j of items) {\n  // profile normalized\n  if (j.public_id) {\n    profiles.push(j);\n    continue;\n  }\n\n  // posts grouped\n  if (j.company_slug && Array.isArray(j.posts)) {\n    postsGrouped.push(j);\n    continue;\n  }\n\n  // company cleaned info\n  if (j.company_slug && (j.website !== undefined || j.employee_count !== undefined || j.description !== undefined)) {\n    companies.push(j);\n    continue;\n  }\n\n  // web company intel (your agent output)\n  // accept either schema style: company_linkedin_url OR company_website etc.\n  if (\n    j.company_linkedin_url &&\n    (j.company_name !== undefined || j.what_they_do !== undefined || j.company_industry !== undefined)\n  ) {\n    webIntels.push(j);\n    continue;\n  }\n}\n\n// ---------- build lookup maps ----------\nconst companyBySlug = new Map();\nfor (const c of companies) {\n  const slug = norm(c.company_slug).toLowerCase();\n  if (!slug) continue;\n  if (!companyBySlug.has(slug)) companyBySlug.set(slug, c);\n}\n\nconst postsBySlug = new Map();\nfor (const pg of postsGrouped) {\n  const slug = norm(pg.company_slug).toLowerCase();\n  if (!slug) continue;\n  postsBySlug.set(slug, Array.isArray(pg.posts) ? pg.posts.slice(0, 5) : []);\n}\n\nconst webBySlug = new Map();\nfor (const w of webIntels) {\n  const slug = companySlugFromUrl(w.company_linkedin_url);\n  if (!slug) continue;\n  if (!webBySlug.has(slug)) webBySlug.set(slug, w);\n}\n\n// ---------- build packets ----------\nconst out = [];\n\nfor (const p of profiles) {\n  const companyLinkedinUrl = norm(p.company_linkedin_url || p.target_url || \"\");\n  const slug = companySlugFromUrl(companyLinkedinUrl);\n\n  const c = (slug && companyBySlug.get(slug)) || {};\n  const w = (slug && webBySlug.get(slug)) || {};\n  const posts = (slug && postsBySlug.get(slug)) || [];\n\n  out.push({\n    json: {\n      person: {\n        public_id: norm(p.public_id),\n        first_name: norm(p.first_name),\n        last_name: norm(p.last_name),\n        name: norm(p.name) || [p.first_name, p.last_name].filter(Boolean).join(\" \").trim(),\n        headline: norm(p.headline),\n        location: norm(p.location),\n        industry: norm(p.industry),\n        summary: p.summary ?? \"\",\n        current_role: p.current_role || {\n          title: norm(p.title),\n          company: norm(p.company),\n          start_date: norm(p.start_date),\n          end_date: norm(p.end_date)\n        },\n        previous_company_url: Array.isArray(p.previous_company_url) ? p.previous_company_url : [],\n        company_slug: slug || \"unknown\",\n        company_linkedin_url: companyLinkedinUrl\n      },\n\n      // company cleaned info (LinkedIn company object)\n      company_linkedin: {\n        company_name: c.company_name ?? norm(p.company),\n        company_slug: c.company_slug ?? (slug || \"\"),\n        company_linkedin_url: c.company_linkedin_url ?? companyLinkedinUrl,\n        website: c.website ?? \"\",\n        industry: c.industry ?? \"\",\n        organization_type: c.organization_type ?? \"\",\n        employee_count: c.employee_count ?? null,\n        followers_count: c.followers_count ?? null,\n        tagline: c.tagline ?? \"\",\n        description: c.description ?? \"\",\n        headquarter: c.headquarter ?? null,\n        top_locations: c.top_locations ?? [],\n        funding_last_round: c.funding_last_round ?? null,\n        logo_url: c.logo_url ?? \"\",\n        cover_image_url: c.cover_image_url ?? \"\"\n      },\n\n      // web company intel (your agent output; keep it as-is but normalize key names lightly)\n      company_web_profile: {\n        company_linkedin_url: w.company_linkedin_url ?? companyLinkedinUrl,\n        company_name: w.company_name ?? \"\",\n        company_url: w.company_url ?? w.company_website ?? \"\",\n        what_they_do: w.what_they_do ?? \"unknown\",\n\n        // allow both schemas (arrays or fields)\n        products_services: w.products_services ?? w.company_products ?? [],\n        target_customers: w.target_customers ?? [],\n        industries: w.industries ?? (w.company_industry ? [w.company_industry] : []),\n        geographies: w.geographies ?? (w.company_headquarters ? [w.company_headquarters] : []),\n        leadership:\n          w.leadership ??\n          (Array.isArray(w.company_leadership)\n            ? w.company_leadership.map(x => `${x.title || \"unknown\"} – ${x.name || \"unknown\"}`)\n            : []),\n        contact_methods:\n          w.contact_methods ??\n          (w.company_contact\n            ? Object.entries(w.company_contact)\n                .filter(([_, v]) => v && v !== \"unknown\")\n                .map(([k, v]) => `${k}: ${v}`)\n            : []),\n\n        notable_clients_or_partners: w.notable_clients_or_partners ?? [],\n        positioning_keywords: w.positioning_keywords ?? [],\n        why_relevant_to_acuvity: w.why_relevant_to_acuvity ?? \"\",\n        confidence: w.confidence ?? \"low\",\n        sources: w.sources ?? []\n      },\n\n      company_recent_posts: posts.map(r => ({\n        created_time: r.created_time ?? \"\",\n        url: r.url || r.shareUrl || \"\",\n        text: r.text ?? \"\",\n        likes: Number(r.likes ?? r.numLikes ?? 0),\n        comments: Number(r.comments ?? r.numComments ?? 0),\n        shares: Number(r.shares ?? r.numShares ?? 0),\n        backend_urn: r.backend_urn ?? \"\"\n      })),\n\n      join_debug: {\n        slug: slug || \"\",\n        has_company: Boolean(slug && companyBySlug.has(slug)),\n        has_web: Boolean(slug && webBySlug.has(slug)),\n        has_posts: Boolean(slug && postsBySlug.has(slug)),\n        company_inputs_seen: companies.length,\n        web_inputs_seen: webIntels.length,\n        posts_inputs_seen: postsGrouped.length\n      }\n    }\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4752,
        3488
      ],
      "id": "62f8406d-e6f0-4da5-9185-ff10b9c73094",
      "name": "Standardize posts info"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        4976,
        2864
      ],
      "id": "fcfca20d-a86d-4c6f-8fc4-f2947e58766e",
      "name": "Merge profile/company info",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * Build Company Lead Packets from appended inputs (safe for inconsistent shapes)\n */\n\nfunction asStr(v) {\n  return (v === null || v === undefined) ? \"\" : String(v);\n}\n\nfunction normUrl(u) {\n  return asStr(u).trim();\n}\n\nfunction companySlugFromLinkedInUrl(url) {\n  const u = asStr(url);\n  const m = u.match(/linkedin\\.com\\/company\\/([^\\/\\?\\#]+)/i);\n  return m ? m[1].toLowerCase() : \"\";\n}\n\nfunction slugFromPostsPayload(post) {\n  return (\n    companySlugFromLinkedInUrl(post?.actor_profile_url || \"\") ||\n    companySlugFromLinkedInUrl(post?.shareUrl || \"\") ||\n    companySlugFromLinkedInUrl(post?.url || \"\")\n  );\n}\n\nfunction cleanText(s) {\n  return asStr(s).replace(/[\\r\\n\\t]+/g, \" \").replace(/\\s+/g, \" \").trim();\n}\n\n/** Ensure we always have an array */\nfunction toArray(v) {\n  if (Array.isArray(v)) return v;\n  if (v === null || v === undefined) return [];\n  // If it's an object (not array), wrap it\n  if (typeof v === \"object\") return [v];\n  // If it's a string/number/etc, wrap it\n  return [v];\n}\n\n/** Normalize leadership to [\"Title – Name\", ...] or [\"unknown\"] if empty */\nfunction normalizeLeadership(v) {\n  const arr = toArray(v);\n  const out = [];\n\n  for (const x of arr) {\n    if (!x) continue;\n\n    // object like {name, title}\n    if (typeof x === \"object\" && !Array.isArray(x)) {\n      const name = cleanText(x.name || \"\");\n      const title = cleanText(x.title || \"\");\n      if (title && name) out.push(`${title} – ${name}`);\n      else if (name) out.push(name);\n      else if (title) out.push(title);\n      else out.push(cleanText(JSON.stringify(x)));\n      continue;\n    }\n\n    // string leadership already formatted\n    out.push(cleanText(x));\n  }\n\n  return out.length ? out : [];\n}\n\nconst all = items.map(i => i.json);\n\n// Buckets keyed by slug\nconst companyBySlug = new Map(); // slug -> linkedin company object\nconst webBySlug = new Map();     // slug -> web.output object\nconst postsBySlug = new Map();   // slug -> posts array\n\nfor (const j of all) {\n  // LinkedIn company object\n  if (j.company_slug && (j.company_linkedin_url || j.website || j.followers_count !== undefined)) {\n    const slug =\n      asStr(j.company_slug).toLowerCase().trim() ||\n      companySlugFromLinkedInUrl(j.company_linkedin_url || \"\");\n    if (!slug) continue;\n    if (!companyBySlug.has(slug)) companyBySlug.set(slug, j);\n    continue;\n  }\n\n  // Web profile object: { output: {...} }\n  if (j.output && (j.output.company_name || j.output.company_linkedin_url || j.output.company_website)) {\n    const out = j.output;\n    const slug = companySlugFromLinkedInUrl(out.company_linkedin_url || \"\");\n    if (!slug) continue;\n    webBySlug.set(slug, out);\n    continue;\n  }\n\n  // Posts payload: { data: { posts: [...] } }\n  if (j.data && Array.isArray(j.data.posts)) {\n    for (const p of j.data.posts) {\n      const slug = slugFromPostsPayload(p);\n      if (!slug) continue;\n      if (!postsBySlug.has(slug)) postsBySlug.set(slug, []);\n      postsBySlug.get(slug).push(p);\n    }\n    continue;\n  }\n}\n\n// Union of slugs\nconst slugs = new Set([\n  ...companyBySlug.keys(),\n  ...webBySlug.keys(),\n  ...postsBySlug.keys(),\n]);\n\nconst outItems = [];\n\nfor (const slug of slugs) {\n  const c = companyBySlug.get(slug) || {};\n  const w = webBySlug.get(slug) || {};\n  const postsRaw = postsBySlug.get(slug) || [];\n\n  postsRaw.sort((a, b) => Number(b.created_time || 0) - Number(a.created_time || 0));\n  const posts = postsRaw.slice(0, 5).map(p => ({\n    created_time: p.created_time || \"\",\n    url: normUrl(p.shareUrl || p.url || \"\"),\n    text: cleanText(p.text || \"\"),\n    likes: Number(p.numLikes || 0),\n    comments: Number(p.numComments || 0),\n    shares: Number(p.numShares || 0),\n    backend_urn: p.backend_urn || \"\"\n  }));\n\n  const leadPacket = {\n    company_linkedin: {\n      company_name: c.company_name || w.company_name || \"\",\n      company_slug: slug,\n      company_linkedin_url: normUrl(c.company_linkedin_url || w.company_linkedin_url || \"\"),\n      website: normUrl(c.website || \"\"),\n      industry: c.industry || \"\",\n      organization_type: c.organization_type || \"\",\n      employee_count: c.employee_count ?? \"\",\n      followers_count: c.followers_count ?? \"\",\n      tagline: c.tagline || \"\",\n      description: cleanText(c.description || \"\"),\n      headquarter: c.headquarter || null,\n      top_locations: toArray(c.top_locations),\n      funding_last_round: c.funding_last_round || null,\n      logo_url: normUrl(c.logo_url || \"\"),\n      cover_image_url: normUrl(c.cover_image_url || \"\")\n    },\n\n    company_web_profile: {\n      company_name: w.company_name || c.company_name || \"\",\n      company_linkedin_url: normUrl(w.company_linkedin_url || c.company_linkedin_url || \"\"),\n      company_website: normUrl(w.company_website || \"\"),\n      company_description: cleanText(w.company_description || \"\"),\n      company_industry: w.company_industry || \"\",\n      company_size: w.company_size || \"\",\n      company_headquarters: w.company_headquarters || \"\",\n      company_founded: w.company_founded || \"\",\n      company_specialties: toArray(w.company_specialties),\n      company_leadership: normalizeLeadership(w.company_leadership),\n      company_contact: (typeof w.company_contact === \"object\" && w.company_contact) ? w.company_contact : {},\n      company_social_media: (typeof w.company_social_media === \"object\" && w.company_social_media) ? w.company_social_media : {},\n      company_address: w.company_address || \"\",\n      company_products_services: toArray(w.company_products_services),\n      company_certifications: toArray(w.company_certifications),\n      company_partners: toArray(w.company_partners),\n      company_offices: toArray(w.company_offices),\n      sources: toArray(w.sources)\n    },\n\n    company_recent_posts: posts,\n\n    join_debug: {\n      slug,\n      has_company_linkedin: companyBySlug.has(slug),\n      has_web_profile: webBySlug.has(slug),\n      has_posts: postsBySlug.has(slug),\n      posts_count: postsRaw.length\n    }\n  };\n\n  outItems.push({ json: { lead_packet: leadPacket } });\n}\n\nreturn outItems;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5200,
        2880
      ],
      "id": "5c38bc2c-5c5f-44c3-b1ac-5423bead851e",
      "name": "create lead packet"
    },
    {
      "parameters": {
        "inputText": "={{ $json }}",
        "categories": {
          "categories": [
            {
              "category": "potential_lead",
              "description": "The input represents a potential B2B lead for Acuvity if the company show credible relevance to enterprise AI, data platforms, GenAI deployment, governance, or security.  A potential lead typically includes one or more of the following: - Responsibility for AI, ML, data platforms, cloud, security, governance, or enterprise systems - Company operating at enterprise scale or in data-heavy / regulated industries - Public signals of AI adoption, data strategy, platform modernization, or security focus  If these signals are weak, missing, or unrelated to enterprise AI or data systems, it should NOT be classified as a potential lead."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "You are a B2B lead qualification assistant.\n\nYour task is to classify the provided JSON lead packet into one of the following categories: {categories}.\n\nThe input is a structured lead packet containing:\n- Company LinkedIn information\n- Company web intelligence\n- Recent company activity/posts\n\nClassify as \"potential_lead\" ONLY if the company show credible relevance to enterprise AI, data platforms, GenAI deployment, governance, or security.\n\nEvaluation criteria:\n- Company scale, industry, and technology focus\n- Evidence of AI, data, platform, or governance responsibility\n- Signals from company description and recent posts\n\nIf relevance is unclear, weak, or missing, do NOT classify as potential_lead.\n\nOutput JSON only.\nDo not explain.",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        5504,
        2880
      ],
      "id": "a009d80a-cf8c-46f1-a1cf-28c5948e616b",
      "name": "Classify Potential Leads"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You will be given a lead packet JSON.\n\nTask:\n1) DO NOT modify, rewrite, or replace any part of the lead packet.\n2) Create a lead assessment for this exact packet.\n\nINPUT_LEAD_PACKET_JSON:\n{{ JSON.stringify($json.lead_packet ?? $json, null, 2) }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a B2B sales qualification analyst.\n\nHard rules:\n- You MUST evaluate ONLY the provided INPUT_LEAD_PACKET_JSON.\n- You MUST NOT invent a different company.\n- You MUST NOT replace the lead_packet with a new one.\n- You MUST preserve the lead packet exactly as-is.\n\nOutput MUST be valid JSON only, with EXACTLY these top-level keys:\n{\n  \"lead_assessment\": {\n    \"is_potential_lead\": true,\n    \"lead_score\": 0,\n    \"lead_tier\": \"Hot|Warm|Cold\",\n    \"why_this_is_a_lead\": \"\",\n    \"key_buying_signals\": [],\n    \"recommended_contact\": { \"role\": \"\", \"reason\": \"\" },\n    \"sales_pitch\": \"\",\n    \"suggested_next_step\": \"\",\n    \"confidence\": \"high|medium|low\"\n  }\n}\n\n\nImportant:\n- lead_packet must be the same structure and values as the input.\n- If something is missing in the packet, say \"unknown\" in assessment fields, do not guess.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        5952,
        2848
      ],
      "id": "497bfde5-e7d3-47f3-9590-d0fd7d305b76",
      "name": "Create Sales Pitch",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        6416,
        2704
      ],
      "id": "140f8211-3b34-43b2-aaf3-65305a8b0747",
      "name": "Merge raw + lead Packet - Company"
    },
    {
      "parameters": {
        "jsCode": "/**\n * UPDATED for your ACTUAL input shape:\n * {\n *   output: { lead_assessment: {...} },\n *   lead_packet: {\n *     company_linkedin: {...},\n *     company_web_profile: {...},\n *     company_recent_posts: [...],\n *     join_debug: {...}\n *   }\n * }\n *\n * Output: 1 flat row with ALL UPPERCASE keys (Sheets friendly)\n */\n\nfunction cleanStr(v) {\n  if (v === null || v === undefined) return \"\";\n  return String(v)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\n+/g, \" • \")\n    .replace(/\\t+/g, \" \")\n    .replace(/\\s{2,}/g, \" \")\n    .trim();\n}\n\nfunction joinArr(v, sep = \" | \") {\n  if (!Array.isArray(v)) return \"\";\n  return v.map((x) => cleanStr(x)).filter(Boolean).join(sep);\n}\n\nfunction boolToStr(v) {\n  if (v === true) return \"TRUE\";\n  if (v === false) return \"FALSE\";\n  if (v === null || v === undefined) return \"\";\n  const s = String(v).trim().toUpperCase();\n  if (s === \"TRUE\" || s === \"FALSE\") return s;\n  return s;\n}\n\nfunction hqString(hq) {\n  if (!hq || typeof hq !== \"object\") return \"\";\n  const parts = [\n    cleanStr(hq.line1),\n    cleanStr(hq.city),\n    cleanStr(hq.geographicArea),\n    cleanStr(hq.country),\n    cleanStr(hq.postalCode),\n  ].filter(Boolean);\n  return parts.join(\", \");\n}\n\nfunction fundingString(f) {\n  if (!f || typeof f !== \"object\") return \"\";\n  const parts = [cleanStr(f.type), cleanStr(f.amount), cleanStr(f.date)].filter(Boolean);\n  return parts.join(\" | \");\n}\n\nfunction postsToString(posts) {\n  if (!Array.isArray(posts) || posts.length === 0) return \"\";\n  return posts\n    .slice(0, 5)\n    .map((p) => {\n      const t = cleanStr(p.text || \"\");\n      const url = cleanStr(p.url || p.shareUrl || \"\");\n      const likes = p.likes ?? p.numLikes ?? \"\";\n      const when = p.created_time ?? \"\";\n      return [when, likes, url, t].filter(Boolean).join(\" | \");\n    })\n    .join(\" || \");\n}\n\nreturn $input.all().map((item) => {\n  const j = item.json || {};\n\n  // ✅ Correct paths for your data\n  const assess = j.output?.lead_assessment || {};\n  const lp = j.lead_packet || {};\n  const companyL = lp.company_linkedin || {};\n  const web = lp.company_web_profile || {};\n  const join = lp.join_debug || {};\n  const posts = lp.company_recent_posts || [];\n\n  const companyName = cleanStr(companyL.company_name || web.company_name || \"\");\n  const companyLinkedInUrl = cleanStr(\n    companyL.company_linkedin_url ||\n      web.company_linkedin_url ||\n      web.company_social_media?.linkedin ||\n      \"\"\n  );\n\n  // Web profile can be in \"company_website\" (your sample) not \"company_url\"\n  const webCompanyUrl = cleanStr(web.company_website || companyL.website || \"\");\n\n  // Leadership can be array of strings OR array of objects in some variants\n  const webLeadership = Array.isArray(web.company_leadership)\n    ? joinArr(\n        web.company_leadership.map((x) =>\n          typeof x === \"string\"\n            ? x\n            : x && typeof x === \"object\"\n            ? `${cleanStr(x.title)} – ${cleanStr(x.name)}`.trim()\n            : \"\"\n        ),\n        \" | \"\n      )\n    : \"\";\n\n  // Contact methods from company_contact object\n  const webContact = web.company_contact || {};\n  const webContactMethods = joinArr(\n    [\n      webContact.phone ? `phone: ${webContact.phone}` : \"\",\n      webContact.email ? `email: ${webContact.email}` : \"\",\n      web.company_address ? `address: ${web.company_address}` : \"\",\n    ].filter(Boolean),\n    \" | \"\n  );\n\n  const row = {\n    // ---- COMPANY IDENTITY FIRST ----\n    COMPANY_NAME: companyName,\n    COMPANY_LINKEDIN_URL: companyLinkedInUrl,\n    COMPANY_WEBSITE: cleanStr(companyL.website || web.company_website || \"\"),\n    COMPANY_SLUG: cleanStr(companyL.company_slug || join.slug || \"\"),\n\n    // ---- LEAD ASSESSMENT ----\n    IS_POTENTIAL_LEAD: boolToStr(assess.is_potential_lead),\n    LEAD_SCORE: cleanStr(assess.lead_score),\n    LEAD_TIER: cleanStr(assess.lead_tier),\n    WHY_THIS_IS_A_LEAD: cleanStr(assess.why_this_is_a_lead),\n    KEY_BUYING_SIGNALS: Array.isArray(assess.key_buying_signals)\n      ? joinArr(assess.key_buying_signals, \" | \")\n      : cleanStr(assess.key_buying_signals),\n    RECOMMENDED_CONTACT_ROLE: cleanStr(assess.recommended_contact?.role),\n    RECOMMENDED_CONTACT_REASON: cleanStr(assess.recommended_contact?.reason),\n    SALES_PITCH: cleanStr(assess.sales_pitch),\n    SUGGESTED_NEXT_STEP: cleanStr(assess.suggested_next_step),\n    CONFIDENCE: cleanStr(assess.confidence),\n\n    // ---- LINKEDIN COMPANY INFO ----\n    COMPANY_INDUSTRY: cleanStr(companyL.industry),\n    COMPANY_ORGANIZATION_TYPE: cleanStr(companyL.organization_type),\n    COMPANY_EMPLOYEE_COUNT: cleanStr(companyL.employee_count),\n    COMPANY_FOLLOWERS_COUNT: cleanStr(companyL.followers_count),\n    COMPANY_TAGLINE: cleanStr(companyL.tagline),\n    COMPANY_DESCRIPTION: cleanStr(companyL.description),\n    COMPANY_HQ: hqString(companyL.headquarter),\n    COMPANY_TOP_LOCATIONS: Array.isArray(companyL.top_locations)\n      ? joinArr(companyL.top_locations.map((x) => x?.address?.line1 || x?.description || \"\"), \" | \")\n      : \"\",\n    COMPANY_FUNDING_LAST_ROUND: fundingString(companyL.funding_last_round),\n    COMPANY_LOGO_URL: cleanStr(companyL.logo_url),\n    COMPANY_COVER_IMAGE_URL: cleanStr(companyL.cover_image_url),\n\n    // ---- WEB COMPANY INTEL ----\n    WEB_COMPANY_WEBSITE: webCompanyUrl,\n    WEB_COMPANY_DESCRIPTION: cleanStr(web.company_description),\n    WEB_COMPANY_INDUSTRY: cleanStr(web.company_industry),\n    WEB_COMPANY_SIZE: cleanStr(web.company_size),\n    WEB_COMPANY_HEADQUARTERS: cleanStr(web.company_headquarters),\n    WEB_COMPANY_FOUNDED: cleanStr(web.company_founded),\n\n    WEB_SPECIALTIES: joinArr(web.company_specialties, \" | \"),\n    WEB_PRODUCTS_SERVICES: joinArr(web.company_products_services, \" | \"),\n    WEB_LEADERSHIP: webLeadership,\n    WEB_CONTACT_METHODS: webContactMethods,\n    WEB_CERTIFICATIONS: joinArr(web.company_certifications, \" | \"),\n    WEB_PARTNERS: joinArr(web.company_partners, \" | \"),\n    WEB_OFFICES: Array.isArray(web.company_offices)\n      ? joinArr(web.company_offices.map((o) => o?.location || \"\"), \" | \")\n      : \"\",\n    WEB_SOURCES: joinArr(web.sources, \" | \"),\n\n    // ---- POSTS ----\n    COMPANY_RECENT_POSTS: postsToString(posts),\n\n    // ---- JOIN DEBUG ----\n    JOIN_HAS_COMPANY_LINKEDIN: boolToStr(join.has_company_linkedin),\n    JOIN_HAS_WEB_PROFILE: boolToStr(join.has_web_profile),\n    JOIN_HAS_POSTS: boolToStr(join.has_posts),\n    JOIN_POSTS_COUNT: cleanStr(join.posts_count),\n  };\n\n  return { json: row };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6704,
        2704
      ],
      "id": "1546284b-eaed-45df-b84c-202cbdb53b80",
      "name": "Prepare for Sheets - Company"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "People",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7136,
        2512
      ],
      "id": "9f27d48f-e26b-4afb-bb34-6b187da67e1f",
      "name": "Unwanted Profile Leads",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 2000131607,
          "mode": "list",
          "cachedResultName": "Company",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MDdJO5ZzpdHeZhCaqNVfD_s7J0BbzIndAgOBotM26tY/edit#gid=2000131607"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7136,
        2704
      ],
      "id": "75a2ecaa-39d4-4c3b-bc8d-674805ec57f8",
      "name": "Company Leads -Append",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 710069432,
          "mode": "list",
          "cachedResultName": "Company",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nIk5BkM70eYnf-sZmacVBN5lDVte9XlWvg_wc6uQf_4/edit#gid=710069432"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6064,
        3456
      ],
      "id": "a81843d1-fc64-4020-b352-27514cdd60be",
      "name": "Unwanted Company Leads - Append",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OqiTq4B9udEOIv8x",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "keyword filter",
            "type": "main",
            "index": 0
          },
          {
            "node": "People Leads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Leads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Events Leads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Unwanted People Leads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Unwanted Company Leads",
            "type": "main",
            "index": 0
          },
          {
            "node": "Unwanted Posts Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "keyword filter": {
      "main": [
        [
          {
            "node": "Keyword Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Keyword Generator",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Search for profiles": {
      "main": [
        [
          {
            "node": "Standardize JSON Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search for companies": {
      "main": [
        [
          {
            "node": "Standardize JSON Output - Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a profile's information": {
      "main": [
        [
          {
            "node": "Profile Normalized",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search for posts": {
      "main": [
        [
          {
            "node": "Standardize JSON Output - Posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Generator": {
      "main": [
        [
          {
            "node": "Search for profiles",
            "type": "main",
            "index": 0
          },
          {
            "node": "Search for companies",
            "type": "main",
            "index": 0
          },
          {
            "node": "Search for posts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Search for events",
            "type": "main",
            "index": 0
          },
          {
            "node": "Web search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search for events": {
      "main": [
        [
          {
            "node": "Standardize JSON Output - Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Web search": {
      "main": [
        [
          {
            "node": "Standardize JSON Output - Web Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get a profile's information",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Categorize companies",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Classify posts as potential lead",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Name from Web search",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search web for Event details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Classify posts as potential lead",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Keyword generator": {
      "ai_languageModel": [
        [
          {
            "node": "Keyword Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Output parser": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Web Search": {
      "ai_languageModel": [
        [
          {
            "node": "Web search",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser - Web Search": {
      "ai_outputParser": [
        [
          {
            "node": "Web search",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Output Parser": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser - Web Search",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Standardize JSON Output": {
      "main": [
        [
          {
            "node": "Merge Search content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standardize JSON Output - Company": {
      "main": [
        [
          {
            "node": "Merge Search content",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Standardize JSON Output - Posts": {
      "main": [
        [
          {
            "node": "Merge Search content",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Standardize JSON Output - Events": {
      "main": [
        [
          {
            "node": "Merge Search content",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Standardize JSON Output - Web Search": {
      "main": [
        [
          {
            "node": "Merge Search content",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Company Web Profile",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Company Web Profile",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Profile Normalized": {
      "main": [
        [
          {
            "node": "Company info",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Posts Top 5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Web Profile",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Profile & Company info",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Company info": {
      "main": [
        [
          {
            "node": "Company Normalized",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Posts Top 5": {
      "main": [
        [
          {
            "node": "Company Posts Normalized",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Web Profile": {
      "main": [
        [
          {
            "node": "Merge Profile & Company info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser - Profile Sales pitch",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Company Posts Top ": {
      "main": [
        [
          {
            "node": "Standardize posts info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Get company profile from web",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Get Company profile from Web",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model11": {
      "ai_languageModel": [
        [
          {
            "node": "Classify Potential Leads",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model12": {
      "ai_languageModel": [
        [
          {
            "node": "Create Sales Pitch",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser4": {
      "ai_outputParser": [
        [
          {
            "node": "Create Sales Pitch",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model13": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model14": {
      "ai_languageModel": [
        [
          {
            "node": "Extract Name from Web search",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model15": {
      "ai_languageModel": [
        [
          {
            "node": "Extract Person Name/Company",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Search web for Event details",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser5": {
      "ai_outputParser": [
        [
          {
            "node": "Search web for Event details",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model16": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model18": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser6": {
      "ai_outputParser": [
        [
          {
            "node": "Create lead packet",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model17": {
      "ai_languageModel": [
        [
          {
            "node": "Create lead packet",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Compare Datasets": {
      "main": [
        [],
        [],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "People Leads": {
      "main": [
        [
          {
            "node": "Standardize People Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Leads": {
      "main": [
        [
          {
            "node": "Standardize Company Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Events Leads": {
      "main": [
        [
          {
            "node": "Standardize Event Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unwanted People Leads": {
      "main": [
        [
          {
            "node": "Standardize Unwanted People Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unwanted Company Leads": {
      "main": [
        [
          {
            "node": "Standardize Unwanted Company Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unwanted Posts Leads": {
      "main": [
        [
          {
            "node": "Standardize Unwanted Posts Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standardize People Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standardize Company Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Standardize Event Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Standardize Unwanted People Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Standardize Unwanted Company Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "Standardize Unwanted Posts Leads": {
      "main": [
        [
          {
            "node": "Merge Google Sheets",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "Merge Google Sheets": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Search content": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Normalized": {
      "main": [
        [
          {
            "node": "Merge Profile & Company info",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Company Posts Normalized": {
      "main": [
        [
          {
            "node": "Merge Profile & Company info",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Merge Profile & Company info": {
      "main": [
        [
          {
            "node": "Create Lead Packet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Lead Packet": {
      "main": [
        [
          {
            "node": "Classify potential lead - People",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify potential lead - People": {
      "main": [
        [
          {
            "node": "Rank & Create sales pitch - Profile",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge raw + Lead packet - Profile",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Unwanted Profile Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Potential Lead": {
      "ai_languageModel": [
        [
          {
            "node": "Classify potential lead - People",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Rank & Create sales pitch - Profile": {
      "main": [
        [
          {
            "node": "Merge raw + Lead packet - Profile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rank & create sales pitch - Profile": {
      "ai_languageModel": [
        [
          {
            "node": "Rank & Create sales pitch - Profile",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser - Profile Sales pitch": {
      "ai_outputParser": [
        [
          {
            "node": "Rank & Create sales pitch - Profile",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structure lead packet for Sheets - Profile": {
      "main": [
        [
          {
            "node": "Profile Leads Sheet - Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge raw + Lead packet - Profile": {
      "main": [
        [
          {
            "node": "Structure lead packet for Sheets - Profile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Categorize companies": {
      "main": [
        [
          {
            "node": "Get company info",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Posts Top ",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Company profile from Web",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Classify real company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify real company": {
      "main": [
        [
          {
            "node": "Extract company name/url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract company name/url": {
      "main": [
        [
          {
            "node": "Search for companies info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify real company1": {
      "ai_languageModel": [
        [
          {
            "node": "Classify real company",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Extract company name/url1": {
      "ai_languageModel": [
        [
          {
            "node": "Extract company name/url",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Search for companies info": {
      "main": [
        [
          {
            "node": "Rename to target url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get company info": {
      "main": [
        [
          {
            "node": "Standardize company info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standardize company info": {
      "main": [
        [
          {
            "node": "Merge profile/company info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rename to target url": {
      "main": [
        [
          {
            "node": "Get company info",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Posts Top ",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Company profile from Web",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Company profile from Web": {
      "main": [
        [
          {
            "node": "Merge profile/company info",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get company profile from web": {
      "ai_outputParser": [
        [
          {
            "node": "Get Company profile from Web",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Extract Name from Web search": {
      "main": [
        [
          {
            "node": "Search fro Profile on LinkedIn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search fro Profile on LinkedIn": {
      "main": [
        [
          {
            "node": "Rename target url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rename target url": {
      "main": [
        [
          {
            "node": "Get a profile's information",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify posts as potential lead": {
      "main": [
        [
          {
            "node": "Extract Person Name/Company",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Not Leads from Posts",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Not Leads from Posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Person Name/Company": {
      "main": [
        [
          {
            "node": "Mention type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mention type": {
      "main": [
        [
          {
            "node": "Switch - Person/Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch - Person/Company": {
      "main": [
        [
          {
            "node": "Search fro Profile on LinkedIn",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get company info",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Company profile from Web",
            "type": "main",
            "index": 0
          },
          {
            "node": "Company Posts Top ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search web for Event details": {
      "main": [
        [
          {
            "node": "Create lead packet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge raw + lead packet - Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create lead packet": {
      "main": [
        [
          {
            "node": "Merge raw + lead packet - Events",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge raw + lead packet - Events": {
      "main": [
        [
          {
            "node": "Prepare for Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Sheets": {
      "main": [
        [
          {
            "node": "Events Leads1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standardize posts info": {
      "main": [
        [
          {
            "node": "Merge profile/company info",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge profile/company info": {
      "main": [
        [
          {
            "node": "create lead packet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create lead packet": {
      "main": [
        [
          {
            "node": "Classify Potential Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Potential Leads": {
      "main": [
        [
          {
            "node": "Create Sales Pitch",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge raw + lead Packet - Company",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Unwanted Company Leads - Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Sales Pitch": {
      "main": [
        [
          {
            "node": "Merge raw + lead Packet - Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge raw + lead Packet - Company": {
      "main": [
        [
          {
            "node": "Prepare for Sheets - Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Sheets - Company": {
      "main": [
        [
          {
            "node": "Company Leads -Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "3c7a357e-1e0e-4236-83e3-7fe83503807a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a2a3d3691cae9941ec9e81fa68f568a800e685a0ab4f08efd2b58055d44cb3c0"
  },
  "id": "9dMA3DswDYttX0Zx",
  "tags": []
}